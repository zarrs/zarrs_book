<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The zarrs Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="This book covers the zarrs Rust crate (and associated tools) for the Zarr storage format for multidimensional arrays and metadata">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/custom.css">
        <link rel="stylesheet" href="theme/pagetoc.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The zarrs Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/zarrs/zarrs_book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><code>zarrs</code> is a Rust library for the Zarr V2 and Zarr V3 array storage formats.
If you don't know what Zarr is, check out:</p>
<ul>
<li>the official Zarr website: <a href="https://zarr.dev">zarr.dev</a>, and</li>
<li>the <a href="https://zarr-specs.readthedocs.io/en/latest/v3/core/v3.0.html">Zarr V3 specification</a>.</li>
</ul>
<p><code>zarrs</code> was originally designed exclusively as a Rust library for Zarr V3.
However, it now supports a V3 compatible subset of Zarr V2, and has Python and C/C++ bindings.
This book details the Rust implementation.</p>
<h2 id="-zarrs-is-fast-"><a class="header" href="#-zarrs-is-fast-">🚀 <code>zarrs</code> is Fast 🚀</a></h2>
<p>The <a href="https://github.com/zarrs/zarr_benchmarks"><img src="https://img.shields.io/badge/zarrs/zarr__benchmarks-GitHub-blue?logo=github" alt="zarr_benchmarks" /></a> repository includes benchmarks of <code>zarrs</code> against other Zarr V3 implementations.
Check out the benchmarks below that measure the time to round trip a \(1024x2048x2048\) <code>uint16</code> array encoded in various ways.
The <code>zarr_benchmarks</code> repository includes additional benchmarks.</p>
<p><img src="./zarr_benchmarks/plots/benchmark_roundtrip.svg" alt="benchmark standalone" /></p>
<!-- ![benchmark dask](./zarr_benchmarks/plots/benchmark_roundtrip_dask.svg) -->
<h2 id="python-bindings-zarrs-python"><a class="header" href="#python-bindings-zarrs-python">Python Bindings: <code>zarrs-python</code> <a href="https://pypi.org/project/zarrs/"><img src="https://img.shields.io/pypi/v/zarrs" alt="zarrs_python_ver" /></a> <a href="https://zarrs-python.readthedocs.io/en/latest/"><img src="https://img.shields.io/readthedocs/zarrs-python" alt="zarrs_python_doc" /></a> <a href="https://github.com/zarrs/zarrs-python"><img src="https://img.shields.io/badge/zarrs/zarrs--python-GitHub-blue?logo=github" alt="zarrs_python_repo" /></a></a></h2>
<p><code>zarrs-python</code> exposes a high-performance <code>zarrs</code>-backed codec pipeline to the reference <a href="https://github.com/zarr-developers/zarr-python"><img src="https://img.shields.io/badge/zarr--developers/zarr--python-GitHub-blue?logo=github" alt="zarr-python" /></a> Python package. It is enabled as follows:</p>
<pre><code class="language-python">from zarr import config
import zarrs # noqa: F401

config.set({"codec_pipeline.path": "zarrs.ZarrsCodecPipeline"})
</code></pre>
<p>That's it!
There is no need to learn a new API and it is supported by downstream libraries like <code>dask</code>.
However, <code>zarrs-python</code> has some limitations.
Consult the <a href="https://github.com/zarrs/zarrs-python"><code>zarrs-python</code> README</a> or <a href="https://pypi.org/project/zarrs/"><code>PyPi</code> docs</a> for more details.</p>
<h2 id="rust-crates"><a class="header" href="#rust-crates">Rust Crates</a></h2>
<p>The Zarr specification is inherently unstable.
It is under active development and new extensions are regularly being introduced.</p>
<p>The <code>zarrs</code> crate has been split into multiple crates to:</p>
<ul>
<li>allow external implementations of stores and extensions points to target a relatively stable API compatible with a range of <code>zarrs</code> versions,</li>
<li>enable automatic backporting of metadata compatibility fixes and changes due to standardisation,</li>
<li>stay up-to-date with unstable public dependencies (e.g. <code>opendal</code>, <code>object_store</code>, <code>icechunk</code>, etc) without impacting the release cycle of <code>zarrs</code>, and</li>
<li>improve compilation times.</li>
</ul>
<p>Below is a slightly simplified overview of the crate structure:</p>
<pre class="mermaid">graph LR
    subgraph tools[CLI Tools]
        zarrs_tools
    end
    subgraph metadata_conventions[Zarr Metadata Conventions]
        ome_zarr_metadata
    end
    subgraph Stores
        direction LR
        zarrs_filesystem[zarrs_filesystem &lt;br&gt; zarrs::filesystem]
        zarrs_object_store
        zarrs_opendal
        zarrs_http
        zarrs_icechunk
    end
    subgraph Core
        zarrs_storage[zarrs_storage &lt;br&gt; zarrs::storage]
        zarrs_metadata_ext[zarrs_metadata_ext &lt;br&gt; zarrs::metadata_ext]
        zarrs_metadata[zarrs_metadata &lt;br&gt; zarrs::metadata]
        zarrs_registry[zarrs_registry &lt;br&gt; zarrs::registry]
        zarrs_plugin[zarrs_plugin &lt;br&gt; zarrs::plugin]
        subgraph Extensions
            direction LR
            zarrs_data_type[zarrs_data_type &lt;br&gt; zarrs::array:data_type]
            %% zarrs_codec TODO
            %% zarrs_chunk_grid TODO
        end
        zarrs
    end
    subgraph storage_adapters[Storage Adapters]
        zarrs_zip
    end
    subgraph Bindings
        %% direction LR
        zarrs_ffi[zarrs_ffi &lt;br&gt; C/C++]
        zarrs-python[zarrs-python &lt;br&gt; Python]
    end
    zarrs_storage --&gt; zarrs
    %% zarrs_registry --&gt; zarrs
    zarrs_metadata_ext --&gt; zarrs
    zarrs_metadata --&gt; zarrs_metadata_ext
    zarrs_registry --&gt; zarrs_metadata_ext
    %% zarrs_metadata --&gt; zarrs
    %% zarrs_metadata --&gt; Extensions
    zarrs_metadata_ext --&gt; Extensions
    zarrs_plugin --&gt; Extensions
    Extensions --&gt; zarrs
    %% zarrs_plugin ---&gt; zarrs
    ome_zarr_metadata --&gt; zarrs_tools
    Stores --&gt; storage_adapters
    storage_adapters --&gt; zarrs_storage
    Stores --&gt; zarrs_storage
    Core --&gt; tools
    Core --&gt; Bindings
</pre>
<p>The core crate is:</p>
<ul>
<li><code>zarrs</code> <a href="https://crates.io/crates/zarrs"><img src="https://img.shields.io/crates/v/zarrs" alt="zarrs_ver" /></a> <a href="https://docs.rs/zarrs"><img src="https://docs.rs/zarrs/badge.svg" alt="zarrs_doc" /></a> <a href="https://github.com/zarrs/zarrs"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs-GitHub-blue?logo=github" alt="zarrs_repo" /></a></li>
</ul>
<p>For local filesystem stores (referred to as <em>native Zarr</em>), this is the only crate you need to depend on.
<code>zarrs</code> has quite a few supplementary crates that are typically just used as transitive dependencies:</p>
<ul>
<li><code>zarrs_metadata</code> <a href="https://crates.io/crates/zarrs_metadata"><img src="https://img.shields.io/crates/v/zarrs_metadata" alt="zarrs_metadata_ver" /></a> <a href="https://docs.rs/zarrs_metadata"><img src="https://docs.rs/zarrs_metadata/badge.svg" alt="zarrs_metadata_doc" /></a> <a href="https://github.com/zarrs/zarrs/tree/main/zarrs_metadata"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__metadata-GitHub-blue?logo=github" alt="zarrs_metadata_repo" /></a></li>
<li><code>zarrs_metadata_ext</code> <a href="https://crates.io/crates/zarrs_metadata_ext"><img src="https://img.shields.io/crates/v/zarrs_metadata_ext" alt="zarrs_metadata_ext_ver" /></a> <a href="https://docs.rs/zarrs_metadata_ext"><img src="https://docs.rs/zarrs_metadata_ext/badge.svg" alt="zarrs_metadata_ext_doc" /></a> <a href="https://github.com/zarrs/zarrs/tree/main/zarrs_metadata_ext"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__metadata_ext-GitHub-blue?logo=github" alt="zarrs_metadata_ext_repo" /></a></li>
<li><code>zarrs_storage</code> <a href="https://crates.io/crates/zarrs_storage"><img src="https://img.shields.io/crates/v/zarrs_storage" alt="zarrs_storage_ver" /></a> <a href="https://docs.rs/zarrs_storage"><img src="https://docs.rs/zarrs_storage/badge.svg" alt="zarrs_storage_doc" /></a> <a href="https://github.com/zarrs/zarrs/tree/main/zarrs_storage"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__storage-GitHub-blue?logo=github" alt="zarrs_storage_repo" /></a></li>
<li><code>zarrs_plugin</code> <a href="https://crates.io/crates/zarrs_plugin"><img src="https://img.shields.io/crates/v/zarrs_plugin" alt="zarrs_plugin_ver" /></a> <a href="https://docs.rs/zarrs_plugin"><img src="https://docs.rs/zarrs_plugin/badge.svg" alt="zarrs_plugin_doc" /></a> <a href="https://github.com/zarrs/zarrs/tree/main/zarrs_plugin"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__plugin-GitHub-blue?logo=github" alt="zarrs_plugin_repo" /></a></li>
<li><code>zarrs_data_type</code> <a href="https://crates.io/crates/zarrs_data_type"><img src="https://img.shields.io/crates/v/zarrs_data_type" alt="zarrs_data_type_ver" /></a> <a href="https://docs.rs/zarrs_data_type"><img src="https://docs.rs/zarrs_data_type/badge.svg" alt="zarrs_data_type_doc" /></a> <a href="https://github.com/zarrs/zarrs/tree/main/zarrs_data_type"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__data_type-GitHub-blue?logo=github" alt="zarrs_data_type_repo" /></a></li>
<li><code>zarrs_registry</code> <a href="https://crates.io/crates/zarrs_registry"><img src="https://img.shields.io/crates/v/zarrs_registry" alt="zarrs_registry_ver" /></a> <a href="https://docs.rs/zarrs_registry"><img src="https://docs.rs/zarrs_registry/badge.svg" alt="zarrs_registry_doc" /></a> <a href="https://github.com/zarrs/zarrs/tree/main/zarrs_registry"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__registry-GitHub-blue?logo=github" alt="zarrs_registry_repo" /></a></li>
</ul>
<p>Additional crates need to be added as dependencies in order to use:</p>
<ul>
<li>remote stores (e.g. HTTP, S3, GCP, etc.),</li>
<li><code>zip</code> stores, or</li>
<li><code>icechunk</code> transactional storage.</li>
</ul>
<p>The <a href="./stores.html">Stores</a> chapter details the various types of stores and their associated crates.</p>
<h2 id="cc-bindings-zarrs_ffi"><a class="header" href="#cc-bindings-zarrs_ffi">C/C++ Bindings: <code>zarrs_ffi</code> <a href="https://crates.io/crates/zarrs_ffi"><img src="https://img.shields.io/crates/v/zarrs_ffi" alt="zarrs_ffi_ver" /></a> <a href="https://docs.rs/zarrs_ffi"><img src="https://docs.rs/zarrs_ffi/badge.svg" alt="zarrs_ffi_doc" /></a> <a href="https://github.com/zarrs/zarrs_ffi"><img src="https://img.shields.io/badge/zarrs/zarrs__ffi-GitHub-blue?logo=github" alt="zarrs_ffi_repo" /></a></a></h2>
<p>A subset of <code>zarrs</code> exposed as a C/C++ API.
<code>zarrs_ffi</code> is a single header library: <code>zarrs.h</code>.
Consult the <a href="https://github.com/zarrs/zarrs_ffi"><code>zarrs_ffi</code> README</a> and <a href="https://zarrs.github.io/zarrs_ffi/zarrs_8h.html">API docs</a> for more information.</p>
<h2 id="cli-tools-zarrs_tools"><a class="header" href="#cli-tools-zarrs_tools">CLI Tools: <code>zarrs_tools</code> <a href="https://crates.io/crates/zarrs_tools"><img src="https://img.shields.io/crates/v/zarrs_tools" alt="zarrs_tools_ver" /></a> <a href="https://docs.rs/zarrs_tools"><img src="https://docs.rs/zarrs_tools/badge.svg" alt="zarrs_tools_doc" /></a> <a href="https://github.com/zarrs/zarrs_tools"><img src="https://img.shields.io/badge/zarrs/zarrs__tools-GitHub-blue?logo=github" alt="zarrs_tools_repo" /></a></a></h2>
<p>Various tools for creating and manipulating Zarr v3 data with the <code>zarrs</code> rust crate.
This crate is detailed in the <a href="./zarrs_tools.html">zarrs_tools</a> chapter.</p>
<h2 id="zarr-metadata-conventions"><a class="header" href="#zarr-metadata-conventions">Zarr Metadata Conventions</a></h2>
<h3 id="ome_zarr_metadata"><a class="header" href="#ome_zarr_metadata"><code>ome_zarr_metadata</code> <a href="https://crates.io/crates/ome_zarr_metadata"><img src="https://img.shields.io/crates/v/ome_zarr_metadata" alt="ome_zarr_metadata_ver" /></a> <a href="https://docs.rs/ome_zarr_metadata"><img src="https://docs.rs/ome_zarr_metadata/badge.svg" alt="ome_zarr_metadata_doc" /></a> <a href="https://github.com/zarrs/rust_ome_zarr_metadata"><img src="https://img.shields.io/badge/zarrs/rust__ome__zarr__metadata-GitHub-blue?logo=github" alt="ome_zarr_metadata_repo" /></a></a></h3>
<p>A Rust library for <a href="https://ngff.openmicroscopy.org/latest/">OME-Zarr</a> (previously OME-NGFF) metadata.</p>
<p>OME-Zarr, formerly known as OME-NGFF (Open Microscopy Environment Next Generation File Format), is a specification designed to support modern scientific imaging needs.
It is widely used in microscopy, bioimaging, and other scientific fields requiring high-dimensional data management, visualisation, and analysis.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>The most recent <code>zarrs</code> requires <a href="https://www.rust-lang.org/">Rust</a> version <img src="https://img.shields.io/crates/msrv/zarrs?label=" alt="msrv" /> or newer.</p>
<p>You can check your current Rust version by running:</p>
<pre><code class="language-sh">rustc --version
</code></pre>
<p>If you don’t have Rust installed, follow the <a href="https://www.rust-lang.org/tools/install">official Rust installation guide</a>.</p>
<p>Some optional <code>zarrs</code> codecs require:</p>
<ul>
<li>The <a href="https://cmake.org/">CMake</a> build system.</li>
<li>The <a href="https://clang.llvm.org/get_started.html">Clang</a> compiler.</li>
</ul>
<p>These are typically available through package managers on Linux, Homebrew on Mac, etc.</p>
<h2 id="adding-zarrs-to-your-rust-libraryapplication"><a class="header" href="#adding-zarrs-to-your-rust-libraryapplication">Adding <code>zarrs</code> to Your Rust Library/Application</a></h2>
<p><code>zarrs</code> is a Rust library.
To use it as a dependency in your Rust project, add it to your <code>Cargo.toml</code> file:</p>
<pre><code class="language-toml">[dependencies]
zarrs = "18.0" # Replace with the latest version
</code></pre>
<p>The latest version is <a href="https://crates.io/crates/zarrs"><img src="https://img.shields.io/crates/v/zarrs.svg" alt="Latest Version" /></a>.
See <a href="https://crates.io/crates/zarrs/versions">crates.io</a> for a full list of versions.</p>
<h2 id="crate-features"><a class="header" href="#crate-features">Crate Features</a></h2>
<p><code>zarrs</code> has a number of features for stores, codecs, or APIs, many of which are enabled by default.
The below example demonstrates how to disable default features and explicitly enable required features:</p>
<pre><code class="language-toml">[dependencies.zarrs]
version = "18.0"
default-features = false
features = ["filesystem", "blosc"]
</code></pre>
<p>See <a href="https://docs.rs/zarrs/latest/zarrs/index.html#crate-features">zarrs (docs.rs) - Crate Features</a> for an up-to-date list of all available features.</p>
<h2 id="supplementary-crates"><a class="header" href="#supplementary-crates">Supplementary Crates</a></h2>
<p>Remote store support and other capabilities are provided by supplementary crates.
See the <a href="./introduction.html#rust-crates">Rust Crates</a> section and <a href="./stores.html">Stores</a> chapter for an overview of the crates available.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarr-stores"><a class="header" href="#zarr-stores">Zarr Stores</a></h1>
<p>A Zarr store is a system that can be used to store and retrieve data from a Zarr hierarchy.
For example: a filesystem, HTTP server, FTP server, Amazon S3 bucket, etc.
A store implements a key/value store interface for storing, retrieving, listing, and erasing keys.</p>
<p>The Zarr V3 storage API is detailed <a href="https://zarr-specs.readthedocs.io/en/latest/v3/core/v3.0.html#storage">here</a> in the Zarr V3 specification.</p>
<h2 id="the-sync-and-async-api"><a class="header" href="#the-sync-and-async-api">The Sync and Async API</a></h2>
<p>Zarr <a href="https://docs.rs/zarrs/latest/zarrs/group/struct.Group.html"><code>Group</code></a>s and <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html"><code>Array</code></a>s are the core components of a Zarr hierarchy.
In <code>zarrs</code>, both structures have both a synchronous and asynchronous API.
The applicable API depends on the storage that the group or array is created with.</p>
<p>Async API methods typically have an <code>async_</code> prefix.
In subsequent chapters, async API method calls are shown commented out below their sync equivalent.</p>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>The async API is still considered experimental, and it requires the <code>async</code> feature.</p>
</div>
<h2 id="synchronous-stores"><a class="header" href="#synchronous-stores">Synchronous Stores</a></h2>
<h3 id="memory"><a class="header" href="#memory">Memory</a></h3>
<p><a href="https://github.com/zarrs/zarrs/tree/main/zarrs_storage"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__storage-GitHub-blue?logo=github" alt="zarrs_storage_repo" /></a> <a href="https://crates.io/crates/zarrs_storage"><img src="https://img.shields.io/crates/v/zarrs_storage" alt="zarrs_storage_ver" /></a> <a href="https://docs.rs/zarrs_storage"><img src="https://docs.rs/zarrs_storage/badge.svg" alt="zarrs_storage_doc" /></a></p>
<p><a href="https://docs.rs/zarrs_storage/latest/zarrs_storage/store/struct.MemoryStore.html"><code>MemoryStore</code></a> is a synchronous in-memory store available in the <a href="https://docs.rs/zarrs_storage/latest/zarrs_storage/"><code>zarrs_storage</code></a> crate (re-exported as <code>zarrs::storage</code>).</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs::storage::ReadableWritableListableStorage;
use zarrs::storage::store::MemoryStore;

let store: ReadableWritableListableStorage = Arc::new(MemoryStore::new());
<span class="boring">}</span></code></pre></pre>
<p>Note that in-memory stores do not persist data, and they are not suited to distributed (i.e. multi-process) usage.</p>
<h3 id="filesystem"><a class="header" href="#filesystem">Filesystem</a></h3>
<p><a href="https://github.com/zarrs/zarrs/tree/main/zarrs_filesystem"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__filesystem-GitHub-blue?logo=github" alt="zarrs_filesystem_repo" /></a> <a href="https://crates.io/crates/zarrs_filesystem"><img src="https://img.shields.io/crates/v/zarrs_filesystem" alt="zarrs_filesystem_ver" /></a> <a href="https://docs.rs/zarrs_filesystem"><img src="https://docs.rs/zarrs_filesystem/badge.svg" alt="zarrs_filesystem_doc" /></a></p>
<p><a href="https://docs.rs/zarrs_filesystem/latest/zarrs_filesystem/struct.FilesystemStore.html"><code>FilesystemStore</code></a> is a synchronous filesystem store available in the <a href="https://docs.rs/zarrs_filesystem/latest/zarrs_filesystem/"><code>zarrs_filesystem</code></a> crate (re-exported as <code>zarrs::filesystem</code> with the <code>filesystem</code> feature).</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs::storage::ReadableWritableListableStorage;
use zarrs::filesystem::FilesystemStore;

let base_path = "/";
let store: ReadableWritableListableStorage =
    Arc::new(FilesystemStore::new(base_path));
<span class="boring">}</span></code></pre></pre>
<p>The base path is the root of the filesystem store.
Node paths are relative to the base path.</p>
<p>The filesystem store also has a <a href="https://docs.rs/zarrs_filesystem/latest/zarrs_filesystem/struct.FilesystemStore.html#method.new_with_options"><code>new_with_options</code></a> constructor.
Currently the only option available for filesystem stores is whether or not to enable direct I/O on Linux.</p>
<h3 id="http"><a class="header" href="#http">HTTP</a></h3>
<p><a href="https://github.com/zarrs/zarrs/tree/main/zarrs_http"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__http-GitHub-blue?logo=github" alt="zarrs_http_repo" /></a> <a href="https://crates.io/crates/zarrs_http"><img src="https://img.shields.io/crates/v/zarrs_http" alt="zarrs_http_ver" /></a> <a href="https://docs.rs/zarrs_http"><img src="https://docs.rs/zarrs_http/badge.svg" alt="zarrs_http_doc" /></a></p>
<p><a href="https://docs.rs/zarrs_http/latest/zarrs_http/struct.HTTPStore.html"><code>HTTPStore</code></a> is a read-only synchronous HTTP store available in the <a href="https://docs.rs/zarrs_http/latest/zarrs_http/"><code>zarrs_http</code></a> crate.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs::storage::ReadableStorage;
use zarrs_http::HTTPStore;

let http_store: ReadableStorage = Arc::new(HTTPStore::new("http://...")?);
<span class="boring">}</span></code></pre></pre>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The HTTP stores provided by <code>object_store</code> and <code>opendal</code> (see below) provide a more comprehensive feature set.</p>
</div>
<h2 id="asynchronous-stores"><a class="header" href="#asynchronous-stores">Asynchronous Stores</a></h2>
<h3 id="object_store"><a class="header" href="#object_store"><code>object_store</code></a></h3>
<p><a href="https://github.com/zarrs/zarrs/tree/main/zarrs_object_store"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__object__store-GitHub-blue?logo=github" alt="zarrs_object_store_repo" /></a> <a href="https://crates.io/crates/zarrs_object_store"><img src="https://img.shields.io/crates/v/zarrs_object_store" alt="zarrs_object_store_ver" /></a> <a href="https://docs.rs/zarrs_object_store"><img src="https://docs.rs/zarrs_object_store/badge.svg" alt="zarrs_object_store_doc" /></a></p>
<p>The <a href="https://crates.io/crates/object_store"><code>object_store</code></a> crate is an <code>async</code> object store library for interacting with object stores.
Supported object stores include:</p>
<ul>
<li><a href="https://aws.amazon.com/s3/">AWS S3</a></li>
<li><a href="https://azure.microsoft.com/en-us/services/storage/blobs/">Azure Blob Storage</a></li>
<li><a href="https://cloud.google.com/storage">Google Cloud Storage</a></li>
<li>Local files</li>
<li>Memory</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc2518">HTTP/WebDAV Storage</a></li>
<li>Custom implementations</li>
</ul>
<p><a href="https://docs.rs/zarrs_object_store/latest/zarrs_object_store/struct.AsyncObjectStore.html"><code>zarrs_object_store::AsyncObjectStore</code></a> wraps <a href="https://docs.rs/object_store/0.11.0/object_store/trait.ObjectStore.html"><code>object_store::ObjectStore</code></a> stores.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs::storage::::AsyncReadableStorage;
use zarrs_object_store::AsyncObjectStore;

let options = object_store::ClientOptions::new().with_allow_http(true);
let store = object_store::http::HttpBuilder::new()
    .with_url("http://...")
    .with_client_options(options)
    .build()?;
let store: AsyncReadableStorage = Arc::new(AsyncObjectStore::new(store));
<span class="boring">}</span></code></pre></pre>
<h3 id="opendal"><a class="header" href="#opendal">OpenDAL</a></h3>
<p><a href="https://github.com/zarrs/zarrs/tree/main/zarrs_opendal"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__opendal-GitHub-blue?logo=github" alt="zarrs_opendal_repo" /></a> <a href="https://crates.io/crates/zarrs_opendal"><img src="https://img.shields.io/crates/v/zarrs_opendal" alt="zarrs_opendal_ver" /></a> <a href="https://docs.rs/zarrs_opendal"><img src="https://docs.rs/zarrs_opendal/badge.svg" alt="zarrs_opendal_doc" /></a></p>
<p>The <a href="https://crates.io/crates/opendal"><code>opendal</code></a> crate offers a unified data access layer, empowering users to seamlessly and efficiently retrieve data from diverse storage services.
It supports a huge range of <a href="https://docs.rs/opendal/latest/opendal/services/index.html">services</a> and <a href="https://docs.rs/opendal/latest/opendal/layers/index.html">layers</a> to extend their behaviour.</p>
<p><a href="https://docs.rs/zarrs_opendal/latest/zarrs_opendal/struct.AsyncOpendalStore.html"><code>zarrs_object_store::AsyncOpendalStore</code></a> wraps <a href="https://docs.rs/opendal/0.50.2/opendal/struct.Operator.html"><code>opendal::Operator</code></a>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs::storage::::AsyncReadableStorage;
use zarrs_opendal::AsyncOpendalStore;

let builder = opendal::services::Http::default().endpoint("http://...");
let operator = opendal::Operator::new(builder)?.finish();
let store: AsyncReadableStorage =
    Arc::new(AsyncOpendalStore::new(operator));
<span class="boring">}</span></code></pre></pre>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Some <code>opendal</code> stores can also be used in a synchronous context with <a href="https://docs.rs/zarrs_opendal/latest/zarrs_opendal/struct.OpendalStore.html"><code>zarrs_object_store::OpendalStore</code></a>, which wraps <a href="https://docs.rs/opendal/0.50.2/opendal/struct.BlockingOperator.html"><code>opendal::BlockingOperator</code></a>.</p>
</div>
<h3 id="icechunk"><a class="header" href="#icechunk">Icechunk</a></h3>
<p><a href="https://github.com/zarrs/zarrs_icechunk"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__icechunk-GitHub-blue?logo=github" alt="zarrs_icechunk_repo" /></a> <a href="https://crates.io/crates/zarrs_icechunk"><img src="https://img.shields.io/crates/v/zarrs_icechunk" alt="zarrs_icechunk_ver" /></a> <a href="https://docs.rs/zarrs_icechunk"><img src="https://docs.rs/zarrs_icechunk/badge.svg" alt="zarrs_icechunk_doc" /></a></p>
<p><a href="https://crates.io/crates/icechunk"><code>icechunk</code></a> is a transactional storage engine for Zarr designed for use on cloud object storage.
It enables <code>git</code>-like functionality for array data.</p>
<p>See an up-to-date example at <a href="https://github.com/zarrs/zarrs_icechunk">https://github.com/zarrs/zarrs_icechunk</a>.</p>
<h2 id="storage-adapters"><a class="header" href="#storage-adapters">Storage Adapters</a></h2>
<p>Storage adapters can be layered on top of stores to change their functionality.</p>
<h3 id="zip"><a class="header" href="#zip">Zip</a></h3>
<p><a href="https://github.com/zarrs/zarrs/tree/main/zarrs_zip"><img src="https://img.shields.io/badge/zarrs/zarrs/zarrs__zip-GitHub-blue?logo=github" alt="zarrs_zip_repo" /></a> <a href="https://crates.io/crates/zarrs_zip"><img src="https://img.shields.io/crates/v/zarrs_zip" alt="zarrs_zip_ver" /></a> <a href="https://docs.rs/zarrs_zip"><img src="https://docs.rs/zarrs_zip/badge.svg" alt="zarrs_zip_doc" /></a></p>
<p>A storage adapter for zip files.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs_storage::StoreKey;
use zarrs_filesystem::FilesystemStore;
use zarrs_zip::ZipStorageAdapter;

let fs_root = PathBuf::from("/path/to/a/directory");
let fs_store = Arc::new(FilesystemStore::new(&amp;fs_root)?);
let zip_key = StoreKey::new("zarr.zip")?;
let zip_store = Arc::new(ZipStorageAdapter::new(fs_store, zip_key)?);
// or ZipStorageAdapter::new_with_path
<span class="boring">}</span></code></pre></pre>
<h3 id="async-to-sync"><a class="header" href="#async-to-sync">Async to Sync</a></h3>
<p>Asynchronous stores can be used in a synchronous context with the <a href="https://docs.rs/zarrs_storage/0.2.2/zarrs_storage/storage_adapter/async_to_sync/struct.AsyncToSyncStorageAdapter.html"><code>zarrs::storage::AsyncToSyncStorageAdapter</code></a>.</p>
<p>The <code>AsyncToSyncBlockOn</code> trait must be implemented for a runtime or runtime handle in order to block on futures.
See the below <code>tokio</code> example:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs::storage::storage_adapter::async_to_sync::AsyncToSyncBlockOn;

struct TokioBlockOn(tokio::runtime::Runtime); // or handle

impl AsyncToSyncBlockOn for TokioBlockOn {
    fn block_on&lt;F: core::future::Future&gt;(&amp;self, future: F) -&gt; F::Output {
        self.0.block_on(future)
    }
}
<span class="boring">}</span></code></pre></pre>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use zarrs::storage::::{AsyncReadableStorage, ReadableStorage};

// Create an async store as normal
let builder = opendal::services::Http::default().endpoint(path);
let operator = opendal::Operator::new(builder)?.finish();
let storage: AsyncReadableStorage =
    Arc::new(AsyncOpendalStore::new(operator));

// Create a tokio runtime and adapt the store to sync
let block_on = TokioBlockOn(tokio::runtime::Runtime::new()?);
let store: ReadableStorage =
    Arc::new(AsyncToSyncStorageAdapter::new(storage, block_on))
<span class="boring">}</span></code></pre></pre>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>Many async stores are not runtime-agnostic (i.e. only support <code>tokio</code>).</p>
</div>
<h3 id="usage-log"><a class="header" href="#usage-log">Usage Log</a></h3>
<p>The <a href="https://docs.rs/zarrs_storage/0.2.2/zarrs_storage/storage_adapter/usage_log/struct.UsageLogStorageAdapter.html"><code>zarrs::storage::UsageLogStorageAdapter</code></a> logs storage method calls.</p>
<p>It is intended to aid in debugging and optimising performance by revealing storage access patterns.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let store = Arc::new(MemoryStore::new());
let log_writer = Arc::new(Mutex::new(
    // std::io::BufWriter::new(
    std::io::stdout(),
    //    )
));
let store = Arc::new(UsageLogStorageAdapter::new(store, log_writer, || {
    chrono::Utc::now().format("[%T%.3f] ").to_string()
}));
<span class="boring">}</span></code></pre></pre>
<h3 id="performance-metrics"><a class="header" href="#performance-metrics">Performance Metrics</a></h3>
<p>The <a href="https://docs.rs/zarrs_storage/0.2.2/zarrs_storage/storage_adapter/performance_metrics/struct.PerformanceMetricsStorageAdapter.html"><code>zarrs::storage::PerformanceMetricsStorageAdapter</code></a> accumulates metrics, such as bytes read and written.</p>
<p>It is intended to aid in testing by allowing the application to validate that metrics (e.g., bytes read/written, total read/write operations) match expected values for specific operations.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let store = Arc::new(MemoryStore::new());
let store = Arc::new(PerformanceMetricsStorageAdapter::new(store));

assert_eq!(store.bytes_read(), ...);
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarr-groups"><a class="header" href="#zarr-groups">Zarr Groups</a></h1>
<p>A group is a node in a Zarr hierarchy that may have child nodes (arrays or groups).</p>
<p><img src="https://zarr-specs.readthedocs.io/en/latest/_images/terminology-hierarchy.excalidraw.png" alt="zarr overview" /></p>
<p>Each array or group in a hierarchy is represented by a metadata document, which is a machine-readable document containing essential processing information about the node.
For a group, the metadata document contains the Zarr Version and optional user attributes.</p>
<h2 id=""><a class="header" href="#"></a></h2>
<h2 id="opening-an-existing-group"><a class="header" href="#opening-an-existing-group">Opening an Existing Group</a></h2>
<p>An existing group can be opened with <a href="https://docs.rs/zarrs/latest/zarrs/group/struct.Group.html#method.open"><code>Group::open</code></a> (or <a href="https://docs.rs/zarrs/latest/zarrs/group/struct.Group.html#method.async_open"><code>async_open</code></a>):</p>
<pre><code class="language-rs">let group = Group::open(store.clone(), "/group")?;
// let group = Group::async_open(store.clone(), "/group").await?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>These methods will open a Zarr V2 or Zarr V3 group.
If you only want to open a specific Zarr version, see <a href="https://docs.rs/zarrs/latest/zarrs/group/struct.Group.html#method.open_opt"><code>open_opt</code></a> and <a href="https://docs.rs/zarrs/latest/zarrs/config/enum.MetadataRetrieveVersion.html"><code>MetadataRetrieveVersion</code></a>.</p>
</div>
<h2 id="creating-attributes"><a class="header" href="#creating-attributes">Creating Attributes</a></h2>
<p>Attributes are encoded in a JSON object (<code>serde_json::Object</code>).</p>
<p>Here are a few different approaches for constructing a JSON object:</p>
<pre><code class="language-rs">let value = serde_json::json!({
    "spam": "ham",
    "eggs": 42
});
</code></pre>
<pre><code class="language-rs">let attributes: serde_json::Object =
    serde_json::json!(value).as_object().unwrap().clone()
</code></pre>
<pre><code class="language-rs">let serde_json::Value::Object(attributes) = value else { unreachable!() };
</code></pre>
<pre><code class="language-rs">let mut attributes =  serde_json::Object::default();
attributes.insert("spam".to_string(), Value::String("ham".to_string()));
attributes.insert("eggs".to_string(), Value::Number(42.into()));
</code></pre>
<p>Alternatively, you can encode your attributes in a struct deriving <code>Serialize</code>, and serialize to a <code>serde_json::Object</code>.</p>
<h2 id="creating-a-group-with-the-groupbuilder"><a class="header" href="#creating-a-group-with-the-groupbuilder">Creating a Group with the <code>GroupBuilder</code></a></h2>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>GroupBuilder</code> only supports Zarr V3 groups.</p>
</div>
<pre><code class="language-rs">let group = zarrs::group::GroupBuilder::new()
    .attributes(attributes)
    .build(store.clone(), "/group")?;
group.store_metadata()?;
// group.async_store_metadata().await?;
</code></pre>
<p>Note that the <code>/group</code> path is relative to the root of the store.</p>
<h2 id="remember-to-store-metadata"><a class="header" href="#remember-to-store-metadata">Remember to Store Metadata!</a></h2>
<p>Group metadata must <strong>always</strong> be stored explicitly, even if the attributes are empty.
Support for implicit groups without metadata <a href="https://github.com/zarr-developers/zarr-specs/pull/292/">was removed long after provisional acceptance of the Zarr V3 specification</a>.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Consider deferring storage of group metadata until child group/array operations are complete.
The presence of valid metadata can act as a signal that the data is ready.</p>
</div>
<h2 id="creating-a-group-from-groupmetadata"><a class="header" href="#creating-a-group-from-groupmetadata">Creating a Group from <code>GroupMetadata</code></a></h2>
<h3 id="zarr-v3"><a class="header" href="#zarr-v3">Zarr V3</a></h3>
<pre><code class="language-rs">/// Specify the group metadata
let metadata: GroupMetadata =
    GroupMetadataV3::new().with_attributes(attributes).into();

/// Create the group and write the metadata
let group =
    Group::new_with_metadata(store.clone(), "/group", metadata)?;
group.store_metadata()?;
// group.async_store_metadata().await?;
</code></pre>
<pre><code class="language-rs">/// Specify the group metadata
let metadata: GroupMetadataV3 = serde_json::from_str(
    r#"{
    "zarr_format": 3,
    "node_type": "group",
    "attributes": {
        "spam": "ham",
        "eggs": 42
    },
    "unknown": {
        "must_understand": false
    }
}"#,
)?;

/// Create the group and write the metadata
let group =
    Group::new_with_metadata(store.clone(), "/group", metadata.into())?;
group.store_metadata()?;
// group.async_store_metadata().await?;
</code></pre>
<h3 id="zarr-v2"><a class="header" href="#zarr-v2">Zarr V2</a></h3>
<pre><code class="language-rs">/// Specify the group metadata
let metadata: GroupMetadata =
    GroupMetadataV2::new().with_attributes(attributes).into();

/// Create the group and write the metadata
let group = Group::new_with_metadata(store.clone(), "/group", metadata)?;
group.store_metadata()?;
// group.async_store_metadata().await?;
</code></pre>
<h2 id="mutating-group-metadata"><a class="header" href="#mutating-group-metadata">Mutating Group Metadata</a></h2>
<p>Group attributes can be changed after initialisation with <a href="https://docs.rs/zarrs/latest/zarrs/group/struct.Group.html#method.attributes_mut"><code>Group::attributes_mut</code></a>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>group
    .attributes_mut()
    .insert("foo".into(), serde_json::Value::String("bar".into()));
group.store_metadata()?;
<span class="boring">}</span></code></pre></pre>
<p>Don't forget to store the updated metadata after attributes have been mutated.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarr-arrays"><a class="header" href="#zarr-arrays">Zarr Arrays</a></h1>
<p>An array is a node in a hierarchy that may not have any child nodes.</p>
<p>An array is a data structure with zero or more dimensions whose lengths define the shape of the array.
An array contains zero or more data elements all of the same data type.</p>
<p><img src="https://zarr-specs.readthedocs.io/en/latest/_images/terminology-read.excalidraw.png" alt="array overview" /></p>
<p>The following sections will detail the initialisation, reading, and writing of arrays.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="array-initialisation"><a class="header" href="#array-initialisation">Array Initialisation</a></h1>
<h2 id="opening-an-existing-array"><a class="header" href="#opening-an-existing-array">Opening an Existing Array</a></h2>
<p>An existing array can be opened with <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.open"><code>Array::open</code></a> (or <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.async_open"><code>async_open</code></a>):</p>
<pre><code class="language-rs">let array_path = "/group/array";
let array = Array::open(store.clone(), array_path)?;
// let array = Array::async_open(store.clone(), array_path).await?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>These methods will open a Zarr V2 or Zarr V3 array.
If you only want to open a specific Zarr version, see <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.open_opt"><code>open_opt</code></a> and <a href="https://docs.rs/zarrs/latest/zarrs/config/enum.MetadataRetrieveVersion.html"><code>MetadataRetrieveVersion</code></a>.</p>
</div>
<h2 id="creating-a-zarr-v3-array-with-the-arraybuilder"><a class="header" href="#creating-a-zarr-v3-array-with-the-arraybuilder">Creating a Zarr V3 Array with the <code>ArrayBuilder</code></a></h2>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>The <code>ArrayBuilder</code> only supports Zarr V3 groups.</p>
</div>
<pre><code class="language-rs">let array_path = "/group/array";
let array = ArrayBuilder::new(
    vec![8, 8], // array shape
    DataType::Float32,
    vec![4, 4].try_into()?, // regular chunk shape
    FillValue::from(ZARR_NAN_F32),
)
// .bytes_to_bytes_codecs(vec![]) // uncompressed
.bytes_to_bytes_codecs(vec![
    Arc::new(GzipCodec::new(5)?),
])
.dimension_names(["y", "x"].into())
// .attributes(...)
// .storage_transformers(vec![].into())
.build(store.clone(), array_path)?;
array.store_metadata()?;
// array.async_store_metadata().await?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The <a href="arrays/./group_init.html">Group Initialisation Chapter</a> has tips for creating attributes.</p>
</div>
<h2 id="remember-to-store-metadata-1"><a class="header" href="#remember-to-store-metadata-1">Remember to Store Metadata!</a></h2>
<p>Array metadata must <strong>always</strong> be stored explicitly, otherwise an array cannot be opened.</p>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Consider deferring storage of array metadata until after chunks operations are complete.
The presence of valid metadata can act as a signal that the data is ready.</p>
</div>
<h2 id="creating-a-zarr-v3-sharded-array"><a class="header" href="#creating-a-zarr-v3-sharded-array">Creating a Zarr V3 Sharded Array</a></h2>
<p>The <a href="https://docs.rs/zarrs/latest/zarrs/array/codec/array_to_bytes/sharding/struct.ShardingCodecBuilder.html"><code>ShardingCodecBuilder</code></a> is useful for creating an array that uses the <code>sharding_indexed</code> codec.</p>
<pre><code class="language-rs">let mut sharding_codec_builder = ShardingCodecBuilder::new(
    vec![4, 4].try_into()? // inner chunk shape
);
sharding_codec_builder.bytes_to_bytes_codecs(vec![
    Arc::new(codec::GzipCodec::new(5)?),
]);

let array = ArrayBuilder::new(
    ...
)
.array_to_bytes_codec(sharding_codec_builder.build_arc())
.build(store.clone(), array_path)?;
array.store_metadata()?;
// array.async_store_metadata().await?;
</code></pre>
<h2 id="creating-a-zarr-v3-array-from-metadata"><a class="header" href="#creating-a-zarr-v3-array-from-metadata">Creating a Zarr V3 Array from Metadata</a></h2>
<p>An array can be created from <code>ArrayMetadata</code> instead of an <code>ArrayBuilder</code> if needed.</p>
<pre><code class="language-rs">let json: &amp;str = r#"{
    "zarr_format": 3,
    "node_type": "array",
    ...
}#";
</code></pre>
<details>
  <summary>Full Zarr V3 array JSON example</summary>
<pre><code class="language-rs">let json: &amp;str = r#"{
    "zarr_format": 3,
    "node_type": "array",
    "shape": [
        10000,
        1000
    ],
    "data_type": "float64",
    "chunk_grid": {
        "name": "regular",
        "configuration": {
        "chunk_shape": [
            1000,
            100
        ]
        }
    },
    "chunk_key_encoding": {
        "name": "default",
        "configuration": {
        "separator": "/"
        }
    },
    "fill_value": "NaN",
    "codecs": [
        {
        "name": "bytes",
        "configuration": {
            "endian": "little"
        }
        },
        {
        "name": "gzip",
        "configuration": {
            "level": 1
        }
        }
    ],
    "attributes": {
        "foo": 42,
        "bar": "apples",
        "baz": [
        1,
        2,
        3,
        4
        ]
    },
    "dimension_names": [
        "rows",
        "columns"
    ]
}"#;
</code></pre>
</details>
<pre><code class="language-rs">/// Parse the JSON metadata
let array_metadata: ArrayMetadata = serde_json::from_str(json)?;

/// Create the array
let array = Array::new_with_metadata(
    store.clone(),
    "/group/array",
    array_metadata.into(),
)?;
array.store_metadata()?;
// array.async_store_metadata().await?;
</code></pre>
<p>Alternatively, <code>ArrayMetadataV3</code> can be constructed with <code>ArrayMetadataV3::new()</code> and subsequent <code>with_</code> methods:</p>
<pre><code class="language-rs">/// Specify the array metadata
let array_metadata: ArrayMetadata = ArrayMetadataV3::new(
    serde_json::from_str("[10, 10]"),
    serde_json::from_str(r#"{"name": "regular", "configuration":{"chunk_shape": [5, 5]}}"#)?,
    serde_json::from_str(r#""float32""#)?,
    serde_json::from_str("0.0")?,
    serde_json::from_str(r#"[ { "name": "blosc", "configuration": { "cname": "blosclz", "clevel": 9, "shuffle": "bitshuffle", "typesize": 2, "blocksize": 0 } } ]"#)?,
).with_chunk_key_encoding(
    serde_json::from_str(r#"{"name": "default", "configuration": {"separator": "/"}}"#)?,
).with_attributes(
    serde_json::from_str(r#"{"foo": 42, "bar": "apples", "baz": [1, 2, 3, 4]}"#)?,
).with_dimension_names(
    Some(serde_json::from_str(r#"["y", "x"]"#)?),
)
.into();

/// Create the array
let array = Array::new_with_metadata(
    store.clone(),
    "/group/array",
    array_metadata,
)?;
array.store_metadata()?;
// array.async_store_metadata().await?;
</code></pre>
<h2 id="creating-a-zarr-v2-array"><a class="header" href="#creating-a-zarr-v2-array">Creating a Zarr V2 Array</a></h2>
<p>The <code>ArrayBuilder</code> does not support Zarr V2 arrays.
Instead, they must be built from <code>ArrayMetadataV2</code>.</p>
<pre><code class="language-rs">/// Specify the array metadata
let array_metadata: ArrayMetadata = ArrayMetadataV2::new(
    vec![10, 10], // array shape
    vec![5, 5].try_into()?, // regular chunk shape
    "&gt;f4".into(), // big endian float32
    FillValueMetadataV2::NaN, // fill value
    None, // compressor
    None, // filters
)
.with_dimension_separator(ChunkKeySeparator::Slash)
.with_order(ArrayMetadataV2Order::F)
.with_attributes(attributes.clone())
.into();

/// Create the array
let array = Array::new_with_metadata(
    store.clone(),
    "/group/array",
    array_metadata,
)?;
array.store_metadata()?;
// array.async_store_metadata().await?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p><code>Array::new_with_metadata</code> can fail if Zarr V2 metadata is unsupported by <code>zarrs</code>.</p>
</div>
<h2 id="mutating-array-metadata"><a class="header" href="#mutating-array-metadata">Mutating Array Metadata</a></h2>
<p>The shape, dimension names, attributes, and additional fields of an array are mutable.</p>
<ul>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.set_shape"><code>Array::set_shape</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.set_dimension_names"><code>Array::set_dimension_names</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.attributes_mut"><code>Array::attributes_mut</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.additional_fields_mut"><code>Array::additional_fields_mut</code></a></li>
</ul>
<p>Don't forget to write the metadata after mutating array metadata!</p>
<hr />
<p>The next chapters detail the reading and writing of array data.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="reading-arrays"><a class="header" href="#reading-arrays">Reading Arrays</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Array operations are divided into several categories based on the traits implemented for the backing storage.
This section focuses on the <a href="https://docs.rs/zarrs_storage/latest/zarrs_storage/trait.ReadableStorageTraits.html"><code>[Async]ReadableStorageTraits</code></a> methods:</p>
<ul>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.retrieve_chunk_if_exists"><code>retrieve_chunk_if_exists</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.retrieve_chunk"><code>retrieve_chunk</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.retrieve_chunks"><code>retrieve_chunks</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.retrieve_chunk_subset"><code>retrieve_chunk_subset</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.retrieve_array_subset"><code>retrieve_array_subset</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.retrieve_encoded_chunk"><code>retrieve_encoded_chunk</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.partial_decoder"><code>partial_decoder</code></a></li>
</ul>
<p>Additional methods are offered by extension traits:</p>
<ul>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayShardedExt.html"><code>ArrayShardedExt</code></a> and <a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayShardedReadableExt.html"><code>ArrayShardedReadableExt</code></a>: see <a href="arrays/array_read.html#reading-inner-chunks-sharded-arrays">Reading Sharded Arrays</a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayChunkCacheExt.html"><code>ArrayChunkCacheExt</code></a>: see <a href="arrays/array_read.html#chunk-caching">Chunk Caching</a></li>
</ul>
<h2 id="method-variants"><a class="header" href="#method-variants">Method Variants</a></h2>
<p>Many <code>retrieve</code> and <code>store</code> methods have multiple variants:</p>
<ul>
<li>Standard variants store or retrieve data represented as <a href="https://docs.rs/zarrs/latest/zarrs/array/enum.ArrayBytes.html"><code>ArrayBytes</code></a> (representing fixed or variable length bytes).</li>
<li><code>_elements</code> suffix variants can store or retrieve chunks with a known type.</li>
<li><code>_ndarray</code> suffix variants can store or retrieve an <a href="https://docs.rs/ndarray/latest/ndarray/type.Array.html"><code>ndarray::Array</code></a> (requires <code>ndarray</code> feature).</li>
<li><code>_opt</code> suffix variants have a <a href="https://docs.rs/zarrs/latest/zarrs/array/codec/options/struct.CodecOptions.html"><code>CodecOptions</code></a> parameter for fine-grained concurrency control and more.</li>
<li>Variants without the <code>_opt</code> suffix use default <code>CodecOptions</code>.</li>
<li><code>async_</code> prefix variants can be used with async stores (requires <code>async</code> feature).</li>
</ul>
<h2 id="reading-a-chunk"><a class="header" href="#reading-a-chunk">Reading a Chunk</a></h2>
<h3 id="reading-and-decoding-a-chunk"><a class="header" href="#reading-and-decoding-a-chunk">Reading and Decoding a Chunk</a></h3>
<pre><code class="language-rs">let chunk_indices: Vec&lt;u64&gt; = vec![1, 2];
let chunk_bytes: ArrayBytes = array.retrieve_chunk(&amp;chunk_indices)?;
let chunk_elements: Vec&lt;f32&gt; =
    array.retrieve_chunk_elements(&amp;chunk_indices)?;
let chunk_array: ndarray::ArrayD&lt;f32&gt; =
    array.retrieve_chunk_ndarray(&amp;chunk_indices)?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p><code>_element</code> and <code>_ndarray</code> variants will fail if the element type does not match the array data type.
They do not perform any conversion.</p>
</div>
<h3 id="skipping-empty-chunks"><a class="header" href="#skipping-empty-chunks">Skipping Empty Chunks</a></h3>
<p>Use <code>retrieve_chunk_if_exists</code> to only retrieve a chunk if it exists (i.e. is not composed entirely of the fill value, or has yet to be written to the store):</p>
<pre><code class="language-rs">let chunk_bytes: Option&lt;ArrayBytes&gt; =
    array.retrieve_chunk_if_exists(&amp;chunk_indices)?;
let chunk_elements: Option&lt;Vec&lt;f32&gt;&gt; =
    array.retrieve_chunk_elements_if_exists(&amp;chunk_indices)?;
let chunk_array: Option&lt;ndarray::ArrayD&lt;f32&gt;&gt; =
    array.retrieve_chunk_ndarray_if_exists(&amp;chunk_indices)?;
</code></pre>
<h3 id="retrieving-an-encoded-chunk"><a class="header" href="#retrieving-an-encoded-chunk">Retrieving an Encoded Chunk</a></h3>
<p>An encoded chunk can be retrieved without decoding with <code>retrieve_encoded_chunk</code>:</p>
<pre><code class="language-rs">let chunk_bytes_encoded: Option&lt;Vec&lt;u8&gt;&gt; =
    array.retrieve_encoded_chunk(&amp;chunk_indices)?;
</code></pre>
<p>This returns <code>None</code> if a chunk does not exist.</p>
<h2 id="parallelism-and-concurrency"><a class="header" href="#parallelism-and-concurrency">Parallelism and Concurrency</a></h2>
<h3 id="codec-and-chunk-parallelism"><a class="header" href="#codec-and-chunk-parallelism">Codec and Chunk Parallelism</a></h3>
<p>Codecs run in parallel on a threadpool.
Array store and retrieve methods will also run in parallel when they involve multiple chunks.
<code>zarrs</code> will automatically choose where to prioritise parallelism between codecs/chunks based on the codecs and number of chunks.</p>
<p>By default, all available CPU cores will be used (where possible/efficient).
Concurrency can be limited globally with <a href="https://docs.rs/zarrs/latest/zarrs/config/struct.Config.html#method.set_codec_concurrent_target"><code>Config::set_codec_concurrent_target</code></a> or as required using <code>_opt</code> methods with <a href="https://docs.rs/zarrs/latest/zarrs/array/codec/options/struct.CodecOptions.html"><code>CodecOptions</code></a> populated with <a href="https://docs.rs/zarrs/latest/zarrs/array/codec/options/struct.CodecOptions.html#method.set_concurrent_target"><code>CodecOptions::set_concurrent_target</code></a>.</p>
<h3 id="async-api-concurrency"><a class="header" href="#async-api-concurrency">Async API Concurrency</a></h3>
<p>This crate is async runtime-agnostic.
Async methods do not spawn tasks internally, so asynchronous storage calls are concurrent but not parallel.
Codec encoding and decoding operations still execute in parallel (where supported) in an asynchronous context.</p>
<p>Due the lack of parallelism, methods like <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.async_retrieve_array_subset"><code>async_retrieve_array_subset</code></a> or <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.async_retrieve_chunks"><code>async_retrieve_chunks</code></a> do not parallelise over chunks and can be slow compared to the  API.
Parallelism over chunks can be achieved by spawning tasks outside of <code>zarrs</code>.
If executing many tasks concurrently, consider reducing the codec <a href="https://docs.rs/zarrs/latest/zarrs/array/codec/options/struct.CodecOptions.html#method.set_concurrent_target"><code>concurrent_target</code></a>.</p>
<h2 id="reading-chunks-in-parallel"><a class="header" href="#reading-chunks-in-parallel">Reading Chunks in Parallel</a></h2>
<p>The <code>retrieve_chunks</code> methods perform chunk retrieval with chunk parallelism.</p>
<p>Rather than taking a <code>&amp;[u64]</code> parameter of the indices of a single chunk, these methods take an <code>ArraySubset</code> representing the chunks.
Rather than returning a <code>Vec</code> for each chunk, the chunks are assembled into a single output for the entire region they cover:</p>
<pre><code class="language-rs">let chunks = ArraySubset::new_with_ranges(&amp;[0..2, 0..4]);
let chunks_bytes: ArrayBytes = array.retrieve_chunks(&amp;chunks)?;
let chunks_elements: Vec&lt;f32&gt; = array.retrieve_chunks_elements(&amp;chunks)?;
let chunks_array: ndarray::ArrayD&lt;f32&gt; =
    array.retrieve_chunks_ndarray(&amp;chunks)?;
</code></pre>
<p><code>retrieve_encoded_chunks</code> differs in that it does not assemble the output.
Chunks returned are in order of the chunk indices returned by <code>chunks.indices().into_iter()</code>:</p>
<pre><code class="language-rs">let chunk_bytes_encoded: Vec&lt;Option&lt;Vec&lt;u8&gt;&gt;&gt; =
    array.retrieve_encoded_chunks(&amp;chunk_indices, &amp;CodecOptions::default()?);
</code></pre>
<h2 id="reading-a-chunk-subset"><a class="header" href="#reading-a-chunk-subset">Reading a Chunk Subset</a></h2>
<p>An <a href="https://docs.rs/zarrs/latest/zarrs/array_subset/struct.ArraySubset.html"><code>ArraySubset</code></a> represents a subset (region) of an array or chunk.
It encodes a starting coordinate and a shape, and is foundational for many array operations.</p>
<p>The below array subsets are all identical:</p>
<pre><code class="language-rs">let subset = ArraySubset::new_with_ranges(&amp;[2..6, 3..5]);
let subset = ArraySubset::new_with_start_shape(vec![2, 3], vec![4, 2])?;
let subset = ArraySubset::new_with_start_end_exc(vec![2, 3], vec![6, 5])?;
let subset = ArraySubset::new_with_start_end_inc(vec![2, 3], vec![5, 4])?;
</code></pre>
<p>The <code>retrieve_chunk_subset</code> methods can be used to retrieve a subset of a chunk:</p>
<pre><code class="language-rs">let chunk_subset: ArraySubset = ...;
let chunk_subset_bytes: ArrayBytes =
    array.retrieve_chunk_subset(&amp;chunk_indices, &amp;chunk_subset)?;
let chunk_subset_elements: Vec&lt;f32&gt; =
    array.retrieve_chunk_subset_elements(&amp;chunk_indices, &amp;chunk_subset)?;
let chunk_subset_array: ndarray::ArrayD&lt;f32&gt; =
    array.retrieve_chunk_subset_ndarray(&amp;chunk_indices, &amp;chunk_subset)?;
</code></pre>
<p>It is important to understand what is going on behind the scenes in these methods.
A partial decoder is created that decodes the requested subset.</p>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>Many codecs <strong>do not support partial decoding</strong>, so partial decoding may result in reading and decoding entire chunks!</p>
</div>
<h2 id="reading-multiple-chunk-subsets"><a class="header" href="#reading-multiple-chunk-subsets">Reading Multiple Chunk Subsets</a></h2>
<p>If multiple chunk subsets are needed from a chunk, prefer to create a partial decoder and reuse it for each chunk subset.</p>
<pre><code class="language-rs">let partial_decoder = array.partial_decoder(&amp;chunk_indices)?;
let chunk_subsets_bytes_a_b: Vec&lt;ArrayBytes&gt; =
    partial_decoder.partial_decode(&amp;[chunk_subset_a, chunk_subset_b, ...])?;
let chunk_subsets_bytes_c: Vec&lt;ArrayBytes&gt; =
    partial_decoder.partial_decode(&amp;[chunk_subset_c])?;
</code></pre>
<p>On initialisation, <strong>partial decoders may insert a cache</strong> (depending on the codecs).
For example, if a codec does not support partial decoding, its output (or an output of one of its predecessors in the codec chain) will be cached, and subsequent partial decoding operations will not access the store.</p>
<h2 id="reading-an-array-subset"><a class="header" href="#reading-an-array-subset">Reading an Array Subset</a></h2>
<p>An arbitrary subset of an array can be read with the <code>retrieve_chunk</code> methods:</p>
<pre><code class="language-rs">let array_subset: ArraySubset = ...;
let subset_bytes: Vec&lt;u8&gt; =
    array.retrieve_array_subset(&amp;array_subset)?;
let subset_elements: Vec&lt;f32&gt; =
    array.retrieve_array_subset_elements(&amp;array_subset)?;
let subset_array: ndarray::ArrayD&lt;f32&gt; =
    array.retrieve_array_subset_ndarray(&amp;array_subset)?;
</code></pre>
<p>Internally, these methods identify the overlapping chunks, call <code>retrieve_chunk</code> / <code>retrieve_chunk_subset</code> with chunk parallelism, and assemble the output.</p>
<h2 id="reading-inner-chunks-sharded-arrays"><a class="header" href="#reading-inner-chunks-sharded-arrays">Reading Inner Chunks (Sharded Arrays)</a></h2>
<p>The <code>sharding_indexed</code> codec enables multiple sub-chunks ("inner chunks") to be stored in a single chunk ("shard").
With a sharded array, the <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunk_grid"><code>chunk_grid</code></a> and chunk indices in store/retrieve methods reference the chunks ("shards") of an array.</p>
<p>The <a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayShardedExt.html"><code>ArrayShardedExt</code></a> trait provides additional methods to <code>Array</code> to query if an array is sharded and retrieve the inner chunk shape.
Additionally, the <em>inner chunk grid</em> can be queried, which is a <a href="https://docs.rs/zarrs/latest/zarrs/array/chunk_grid/struct.ChunkGrid.html"><code>ChunkGrid</code></a> where chunk indices refer to inner chunks rather than shards.</p>
<p>The <a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayShardedReadableExt.html"><code>ArrayShardedReadableExt</code></a> trait adds <code>Array</code> methods to conveniently and efficiently access the data in a sharded array (with <code>_elements</code> and <code>_ndarray</code> variants):</p>
<ul>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayShardedReadableExt.html#tymethod.retrieve_inner_chunk_opt"><code>retrieve_inner_chunk_opt</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayShardedReadableExt.html#tymethod.retrieve_inner_chunks_opt"><code>retrieve_inner_chunks_opt</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayShardedReadableExt.html#tymethod.retrieve_array_subset_sharded_opt"><code>retrieve_array_subset_sharded_opt</code></a></li>
</ul>
<p>For unsharded arrays, these methods gracefully fallback to referencing standard chunks.
Each method has a <code>cache</code> parameter (<a href="https://docs.rs/zarrs/latest/zarrs/array/struct.ArrayShardedReadableExtCache.html"><code>ArrayShardedReadableExtCache</code></a>) that stores shard indexes so that they do not have to be repeatedly retrieved and decoded.</p>
<h2 id="querying-chunk-bounds"><a class="header" href="#querying-chunk-bounds">Querying Chunk Bounds</a></h2>
<p>Several convenience methods are available for querying the underlying chunk grid:</p>
<ul>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunk_origin"><code>chunk_origin</code></a>: Get the origin of a chunk.</li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunk_shape"><code>chunk_shape</code></a>: Get the shape of a chunk.</li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunk_subset"><code>chunk_subset</code></a>: Get the <code>ArraySubset</code> of a chunk.</li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunk_subset_bounded"><code>chunk_subset_bounded</code></a>: Get the <code>ArraySubset</code> of a chunk, bounded by the array shape.</li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunks_subset"><code>chunks_subset</code></a> / <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunks_subset_bounded"><code>chunks_subset_bounded</code></a>: Get the <code>ArraySubset</code> of a group of chunks.</li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.chunks_in_array_subset"><code>chunks_in_array_subset</code></a>: Get the chunks in an <code>ArraySubset</code>.</li>
</ul>
<p>An <code>ArraySubset</code> spanning an array can be retrieved with <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.subset_all"><code>subset_all</code></a>.</p>
<h2 id="iterating-over-chunks--regions"><a class="header" href="#iterating-over-chunks--regions">Iterating Over Chunks / Regions</a></h2>
<p>Iterating over chunks or regions is a common pattern.
There are several approaches.</p>
<h3 id="serial-chunk-iteration"><a class="header" href="#serial-chunk-iteration">Serial Chunk Iteration</a></h3>
<pre><code class="language-rs">let indices = chunks.indices();
for chunk_indices in indices {
    ...
}
</code></pre>
<h3 id="parallel-chunk-iteration"><a class="header" href="#parallel-chunk-iteration">Parallel Chunk Iteration</a></h3>
<pre><code class="language-rs">let indices = chunks.indices();
chunks.into_par_iter().try_for_each(|chunk_indices| {
    ...
})?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>Reading chunks in parallel (as above) can use a lot of memory if chunks are large.</p>
</div>
<p>The <code>zarrs</code> crate internally uses a macro from the <a href="https://docs.rs/rayon_iter_concurrent_limit/latest/rayon_iter_concurrent_limit/"><code>rayon_iter_concurrent_limit</code></a> crate to limit chunk parallelism where reasonable.
This macro is a simple wrapper over <code>.into_par_iter().chunks(...).&lt;func&gt;</code>.
For example:</p>
<pre><code class="language-rs">let chunk_concurrent_limit: usize = 4;
rayon_iter_concurrent_limit::iter_concurrent_limit!(
    chunk_concurrent_limit,
    indices,
    try_for_each,
    |chunk_indices| { 
        ...
    }
)?;
</code></pre>
<!-- TODO more types of iteration -->
<h2 id="chunk-caching"><a class="header" href="#chunk-caching">Chunk Caching</a></h2>
<p>The standard <code>Array</code> retrieve methods do not perform any chunk caching.
This means that requesting the same chunk again will result in another read from the store.</p>
<p>The <a href="https://docs.rs/zarrs/latest/zarrs/array/trait.ArrayChunkCacheExt.html"><code>ArrayChunkCacheExt</code></a> trait adds <code>Array</code> retrieve methods that support chunk caching.
Various type of chunk caches are supported (e.g. encoded cache, decoded cache, chunk limited, size limited, thread local, etc.).
See the <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#chunk-caching">Chunk Caching</a> section of the <code>Array</code> docs for more information on these methods.</p>
<p>Chunk caching is likely to be effective for remote stores where redundant retrievals are costly.
However, chunk caching may not outperform disk caching with a filesystem store.
The caches use internal locking to support multithreading, which has a performance overhead.</p>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>Prefer not to use a chunk cache if chunks are not accessed repeatedly.
Cached retrieve methods do not use partial decoders, and any intersected chunk is fully decoded if not present in the cache.</p>
</div>
<p>For many access patterns, chunk caching may reduce performance.
<strong>Benchmark your algorithm/data</strong>.</p>
<h2 id="reading-a-string-array"><a class="header" href="#reading-a-string-array">Reading a String Array</a></h2>
<p>A string array can be read as normal with any of the array retrieve methods.</p>
<pre><code class="language-rs">let chunks_elements: Vec&lt;String&gt; = array.retrieve_chunks_elements(&amp;chunks)?;
let chunks_array: ndarray::ArrayD&lt;String&gt; =
    array.retrieve_chunks_ndarray(&amp;chunks)?;
</code></pre>
<p>However, this results in a string allocation per element.
This can be avoided by retrieving the bytes directly and converting them to a <code>Vec</code> of string references.
For example:</p>
<pre><code class="language-rs">let chunks_bytes: ArrayBytes = array.retrieve_chunks(&amp;chunks)?;
let (bytes, offsets) = chunks_bytes.into_variable()?;
let string = String::from_utf8(bytes.into_owned())?;
let chunks_elements: Vec&lt;&amp;str&gt; = offsets
    .iter()
    .tuple_windows()
    .map(|(&amp;curr, &amp;next)| &amp;string[curr..next])
    .collect();
let chunks_array =
    ArrayD::&lt;&amp;str&gt;::from_shape_vec(subset_all.shape_usize(), chunks_elements)?;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="writing-arrays"><a class="header" href="#writing-arrays">Writing Arrays</a></h1>
<p><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html"><code>Array</code></a> write methods are separated based on two storage traits:</p>
<ul>
<li><code>[Async]WritableStorageTraits</code> methods perform write operations exclusively, and</li>
<li><code>[Async]ReadableWritableStorageTraits</code> methods perform write operations and may perform read operations.</li>
</ul>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>Misuse of <code>[Async]ReadableWritableStorageTraits</code> <code>Array</code> methods can result in data loss due to partial writes being lost.
<code>zarrs</code> does not currently offer a “synchronisation” API for locking chunks or array subsets.</p>
</div>
<h2 id="write-only-methods"><a class="header" href="#write-only-methods">Write-Only Methods</a></h2>
<p>The <a href="https://docs.rs/zarrs_storage/latest/zarrs_storage/trait.WritableStorageTraits.html"><code>[Async]WritableStorageTraits</code></a> grouped methods exclusively perform <em>write operations</em>:</p>
<!-- - [`store_metadata`](https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.store_metadata) -->
<!-- - [`erase_metadata`](https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.erase_metadata) -->
<ul>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.store_chunk"><code>store_chunk</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.store_chunks"><code>store_chunks</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.store_encoded_chunk"><code>store_encoded_chunk</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.erase_chunk"><code>erase_chunk</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.erase_chunks"><code>erase_chunks</code></a></li>
</ul>
<h3 id="store-a-chunk"><a class="header" href="#store-a-chunk">Store a Chunk</a></h3>
<pre><code class="language-rs">let chunk_indices: Vec&lt;u64&gt; = vec![1, 2];
let chunk_bytes: Vec&lt;u8&gt; = vec![...];
array.store_chunk(&amp;chunk_indices, chunk_bytes.into())?;
let chunk_elements: Vec&lt;f32&gt; = vec![...];
array.store_chunk_elements(&amp;chunk_indices, &amp;chunk_elements)?;
let chunk_array = ArrayD::&lt;f32&gt;::from_shape_vec(
    vec![2, 2], // chunk shape
    chunk_elements
)?;
array.store_chunk_elements(&amp;chunk_indices, chunk_array)?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>If a chunk is written more than once, its element values depend on whichever operation wrote to the chunk last.</p>
</div>
<h3 id="store-chunks"><a class="header" href="#store-chunks">Store Chunks</a></h3>
<p><code>store_chunks</code> (and variants) will dissasemble the input into chunks, and encode and store them in parallel.</p>
<pre><code class="language-rs">let chunks = ArraySubset::new_with_ranges(&amp;[0..2, 0..4]);
let chunks_bytes: Vec&lt;u8&gt; = vec![...];
array.store_chunks(&amp;chunks, chunks_bytes.into())?;
// store_chunks_elements, store_chunks_ndarray...
</code></pre>
<h3 id="store-an-encoded-chunk"><a class="header" href="#store-an-encoded-chunk">Store an Encoded Chunk</a></h3>
<p>An encoded chunk can be stored directly with <a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.store_encoded_chunk">store_encoded_chunk</a>, bypassing the <code>zarrs</code> codec pipeline.</p>
<pre><code class="language-rs">let encoded_chunk_bytes: Vec&lt;u8&gt; = ...;
array.store_encoded_chunk(&amp;chunks, encoded_chunk_bytes.into())?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>Currently, the most performant path for uncompressed writing on Linux is to reuse page aligned buffers via <code>store_encoded_chunk</code> with direct IO enabled for the <code>FilesystemStore</code>.
See <a href="https://github.com/zarrs/zarrs/pull/58">zarrs GitHub issue #58</a> for a discussion of this method.</p>
</div>
<h2 id="read-write-methods"><a class="header" href="#read-write-methods">Read-Write Methods</a></h2>
<p>The <a href="https://docs.rs/zarrs_storage/latest/zarrs_storage/trait.ReadableWritableStorageTraits.html"><code>[Async]ReadableWritableStorageTraits</code></a> grouped methods perform write operations and <em>may perform read operations</em>:</p>
<ul>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.store_chunk_subset"><code>store_chunk_subset</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.store_array_subset"><code>store_array_subset</code></a></li>
<li><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.Array.html#method.partial_encoder"><code>partial_encoder</code></a></li>
</ul>
<p>These methods perform partial encoding.
Codecs that do not support true partial encoding will retrieve chunks in their entirety, then decode, update, and store them.</p>
<p>It is the responsibility of zarrs consumers to ensure:</p>
<ul>
<li><code>store_chunk_subset</code> is not called concurrently on the same chunk, and</li>
<li><code>store_array_subset</code> is not called concurrently on array subsets sharing chunks.</li>
</ul>
<p>Partial writes to a chunk may be lost if these rules are not respected.</p>
<h3 id="store-a-chunk-subset"><a class="header" href="#store-a-chunk-subset">Store a Chunk Subset</a></h3>
<pre><code class="language-rs">array.store_chunk_subset_elements::&lt;f32&gt;(
    // chunk indices
    &amp;[3, 1],
    // subset within chunk
    &amp;ArraySubset::new_with_ranges(&amp;[1..2, 0..4]),
    // subset elements
    &amp;[-4.0; 4],
)?;
</code></pre>
<h3 id="store-an-array-subset"><a class="header" href="#store-an-array-subset">Store an Array Subset</a></h3>
<pre><code class="language-rs">array.store_array_subset_elements::&lt;f32&gt;(
    &amp;ArraySubset::new_with_ranges(&amp;[0..8, 6..7]),
    &amp;[123.0; 8],
)?;
</code></pre>
<h3 id="partial-encoding-with-the-sharding-codec"><a class="header" href="#partial-encoding-with-the-sharding-codec">Partial Encoding with the Sharding Codec</a></h3>
<p>In <code>zarrs</code>, the <code>sharding_indexed</code> codec is the only codec that supports real partial encoding if the <a href="https://docs.rs/zarrs/latest/zarrs/config/struct.Config.html#experimental-partial-decoding"><code>Experimental Partial Encoding</code></a> option is enabled.
If disabled (default), chunks are always fully decoded and updated before being stored.</p>
<p>To enable partial encoding:</p>
<pre><code class="language-rs">// Set experimental_partial_encoding to true by default
zarrs::config::global_config_mut().set_experimental_partial_encoding(true);

// Manually set experimental_partial_encoding to true for an operation
let mut options = CodecOptions::default();
options.set_experimental_partial_encoding(true);
</code></pre>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>The asynchronous API does not yet support partial encoding.</p>
</div>
<p>This enables <code>Array::store_array_subset</code>, <code>Array::store_chunk_subset</code>, <code>Array::partial_encoder</code>, and variants to use partial encoding for sharded arrays.
Inner chunks can be written in an append-only fashion without reading previously written inner chunks (if their elements do not require updating).</p>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>Since partial encoding is append-only for sharded arrays, updating a chunk does not remove the originally encoded data.
Make sure to align writes to the inner chunks, otherwise your shards will be much larger than they should be.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="converting-zarr-v2-to-v3"><a class="header" href="#converting-zarr-v2-to-v3">Converting Zarr V2 to V3</a></h1>
<h2 id="cli-tool"><a class="header" href="#cli-tool">CLI tool</a></h2>
<p><code>zarrs_reencode</code> is a CLI tool that supports Zarr V2 to V3 conversion. See the <a href="./zarrs_tools/docs/zarrs_reencode.html">zarrs_reencode</a> section.</p>
<h2 id="changing-the-internal-representation"><a class="header" href="#changing-the-internal-representation">Changing the Internal Representation</a></h2>
<p>When an array or group is initialised, it internally holds metadata in the Zarr version it was created with.</p>
<p>To change the internal representation to Zarr V3, call <code>to_v3()</code> on an <code>Array</code> or <code>Group</code>, then call <code>store_metadata()</code> to update the stored metadata.
V2 metadata must be explicitly erased if needed (see below).</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>While <code>zarrs</code> fully supports manipulation of Zarr V2 and V3 hierarchies (with supported codecs, data types, etc.), it only supports <strong>forward conversion</strong> of metadata from Zarr V2 to V3.</p>
</div>
<h3 id="convert-a-group-to-v3"><a class="header" href="#convert-a-group-to-v3">Convert a Group to V3</a></h3>
<pre><code class="language-rs">let group: Group = group.to_v3();
group.store_metadata()?;
// group.async_store_metadata().await?;
group.erase_metadata_opt(MetadataEraseVersion::V2)?;
// group.async_erase_metadata_opt(MetadataEraseVersion::V2).await?;
</code></pre>
<h3 id="convert-an-array-to-v3"><a class="header" href="#convert-an-array-to-v3">Convert an Array to V3</a></h3>
<pre><code class="language-rs">let array: Array = array.to_v3()?;
array.store_metadata()?;
// array.async_store_metadata().await?;
array.erase_metadata_opt(MetadataEraseVersion::V2)?;
// array.async_erase_metadata_opt(MetadataEraseVersion::V2).await?;
</code></pre>
<p>Note that <code>Array::to_v3()</code> is fallible because some V2 metadata is not V3 compatible.</p>
<h2 id="writing-versioned-metadata-explicitly"><a class="header" href="#writing-versioned-metadata-explicitly">Writing Versioned Metadata Explicitly</a></h2>
<p>Rather than changing the internal representation, an alternative is to just write metadata with a specified version.</p>
<p>For groups, the <code>store_metadata_opt</code> accepts a <a href="https://docs.rs/zarrs/latest/zarrs/group/struct.GroupMetadataOptions.html"><code>GroupMetadataOptions</code></a> argument.
<code>GroupMetadataOptions</code> currently has only one option that impacts the Zarr version of the metadata.
By default, <code>GroupMetadataOptions</code> keeps the current Zarr version.</p>
<p>To write Zarr V3 metadata:</p>
<pre><code class="language-rs">group.store_metadata_opt(&amp;
    GroupMetadataOptions::default()
    .with_metadata_convert_version(MetadataConvertVersion::V3)
)?;
// group.async_store_metadata_opt(...).await?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p><code>zarrs</code> does not support converting Zarr V3 metadata to Zarr V2.</p>
</div>
<p>Note that the original metadata is not automatically deleted.
If you want to delete it:</p>
<pre><code class="language-rs">group.erase_metadata()?;
// group.async_erase_metadata().await?;
</code></pre>
<div class="mdbook-alerts mdbook-alerts-tip">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  tip
</p>
<p>The <code>store_metadata</code> methods of <code>Array</code> and <code>Group</code> internally call <a href="https://docs.rs/zarrs/latest/zarrs/group/struct.Group.html#method.store_metadata_opt"><code>store_metadata_opt</code></a>.
Global defaults can be changed, see <a href="https://docs.rs/zarrs/latest/zarrs/config/struct.Config.html">zarrs::global::Config</a>.</p>
</div>
<p><a href="https://docs.rs/zarrs/latest/zarrs/array/struct.ArrayMetadataOptions.html"><code>ArrayMetadataOptions</code></a> has similar options for changing the Zarr version of the metadata.
It also has various other configuration options, see its documentation.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p>The Zarr v3 specification defines several explicit <strong>extension points</strong>, which are specific components of the Zarr model that can be replaced or augmented with custom implementations:</p>
<ul>
<li><strong>Codecs</strong>: Codecs define how chunk data is transformed between its in-memory representation and its stored (bytes) representation.
Zarr allows chaining multiple codecs, creating sophisticated data transformation pipelines.</li>
<li><strong>Data types</strong>: The element representation of the array. Array-to-array codecs may change the data type of chunk data on encoding, but this is reversed on decoding.</li>
<li><strong>Chunk Grids</strong>: Define how the N-dimensional array space is partitioned into chunks. The specification only defines a <code>regular</code> grid, and a <code>rectangular</code> grid is proposed.</li>
<li><strong>Chunk Key Encoding</strong>: Specifies how the logical coordinates of a chunk are mapped to the string key used for storage (e.g., <code>(0, 1, 0)</code> to <code>c/0/1/0</code>, <code>c.0.1.0</code>, <code>/0/1/0</code>, etc.). The specification defines <code>default</code> and <code>v2</code> encodings.</li>
<li><strong>Storage Transformers</strong>: These modify the interaction between the logical Zarr hierarchy (groups, arrays, chunks) and the underlying storage system. The specification does not define nay storage transformers.</li>
<li><strong>Stores</strong> While not strictly an extension point, the ability to interact with different storage backends is a crucial aspect of Zarr's flexibility.
The <code>zarrs</code> library, like other Zarr implementations, leverages this by providing its own Storage API for reading, writing, and listing data.
<code>zarrs</code> can work with virtually any storage system – in-memory buffers, local filesystems, object stores (like S3 or GCS), databases, etc.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="codec-extensions"><a class="header" href="#codec-extensions">Codec Extensions</a></h1>
<p>Among the most impactful and frequently utilised extension points are <strong>codecs</strong>. At their core, codecs define the transformations applied to array chunk data as it moves between its logical, in-memory representation and its serialized, stored representation as a sequence of bytes.</p>
<p>Codecs are the workhorses behind essential Zarr features like <strong>compression</strong> (reducing storage size and transfer time) and <strong>filtering</strong> (rearranging or modifying data to improve compression effectiveness). The Zarr v3 specification allows for a <strong>pipeline of codecs</strong> to be defined for each array, where the output of one codec becomes the input for the next during encoding, and the process is reversed during decoding.</p>
<h2 id="types-of-codecs"><a class="header" href="#types-of-codecs">Types of Codecs</a></h2>
<p>The Zarr v3 specification categorizes codecs based on the type of data they operate on and produce:</p>
<ol>
<li>
<p><strong>Array-to-Array (A-&gt;A) Codecs:</strong> These codecs transform an array chunk <em>before</em> it is serialized into bytes. They operate on an in-memory array representation and produce another in-memory array representation. Examples could include codecs that transpose data within a chunk, change the data type (e.g., <code>float32</code> to <code>float16</code>), or apply operations that make an array more amenable to compression.</p>
</li>
<li>
<p><strong>Array-to-Bytes (A-&gt;B) Codecs:</strong> This type of codec handles the crucial step of converting an in-memory array chunk into a sequence of bytes. This typically involves flattening the multidimensional array data and handling endianness conversions if necessary. Every codec pipeline must include at least one <code>A-&gt;B</code> codec.</p>
</li>
<li>
<p><strong>Bytes-to-Bytes (B-&gt;B) Codecs:</strong> These codecs take a sequence of bytes as input and produce a sequence of bytes as output. This is the category where most common compression algorithms (like <code>blosc</code>, <code>zstd</code>, <code>gzip</code>) and byte-level filters (like <code>shuffle</code> for improving compressibility, or checksums) reside. Multiple <code>B-&gt;B</code> codecs can be chained together.</p>
</li>
</ol>
<h2 id="codecs-in-zarrs"><a class="header" href="#codecs-in-zarrs">Codecs in <code>zarrs</code></a></h2>
<p>The <code>zarrs</code> library mirrors these conceptual types using a set of Rust <strong>traits</strong>. To implement a custom codec, you must implement the following traits depending on the codec type:</p>
<ul>
<li><code>A-&gt;A</code>: <code>CodecTraits</code> + <code>ArrayCodecTraits</code> + <code>ArrayToArrayCodecTraits</code></li>
<li><code>A-&gt;B</code>: <code>CodecTraits</code> + <code>ArrayCodecTraits</code> + <code>ArrayToBytesCodecTraits</code></li>
<li><code>B-&gt;B</code>: <code>CodecTraits</code> + <code>BytesToBytesCodecTraits</code></li>
</ul>
<p>The traits are:</p>
<ul>
<li><code>CodecTraits</code>: Defines the codec <code>configuration</code> creation method, the unique <code>zarrs</code> codec <code>identifier</code>, and some hints related to partial decoding.</li>
<li><code>ArrayCodecTraits</code>: defines the <code>recommended_concurrency</code> and <code>partial_decode_granularity</code>.</li>
<li><code>ArrayToArrayCodecTraits</code> / <code>ArrayToBytesCodecTraits</code> / <code>BytesToBytesCodecTraits</code>: Defines the codec <code>encode</code> and <code>decode</code> methods (including partial encoding and decoding), as well as methods for querying the encoded representation.</li>
</ul>
<p>These traits define the necessary <code>encode</code> and <code>decode</code> methods (complete and partial), methods for inspecting the encoded chunk representation, hints for concurrent processing, and more.</p>
<p>The best way to learn to implement a new codec is to look at the existing codecs implemented in <code>zarrs</code>.</p>
<h2 id="example-an-lz4-bytes-to-bytes-codec"><a class="header" href="#example-an-lz4-bytes-to-bytes-codec">Example: An <code>LZ4</code> Bytes-to-Bytes Codec</a></h2>
<p><code>LZ4</code> is common lossless compression algorithm.
Let's implement the <code>numcodecs.lz4</code> codec, which is supported by <code>zarr-python</code> 3.0.0+ for Zarr V3 data.</p>
<h3 id="the-lz4codecconfiguration-struct"><a class="header" href="#the-lz4codecconfiguration-struct">The <code>Lz4CodecConfiguration</code> Struct</a></h3>
<p>Looking at the <a href="https://numcodecs.readthedocs.io/en/stable/compression/lz4.html">docs for the <code>numcodecs</code> <code>LZ4</code> codec</a>, it has a single <code>"acceleration"</code> parameter.
The valid range for <code>"accleration"</code> is not documented, but the <code>LZ4</code> library itself will <a href="https://github.com/lz4/lz4/blob/fa1634e2ccd41ac09c087ab65e96bcbbd003fd20/lib/lz4.h#L228-L235">clamp the acceleration between 1 and the maximum supported compression level</a>.
So, any <code>i32</code> can be permitted here and there is no need follow <a href="https://doc.rust-lang.org/rust-by-example/generics/new_types.html">New Type Idiom</a>.</p>
<p>The expected form of the codec in array metadata is:</p>
<pre><code class="language-json">[
    ...
    {
        "name": "numcodecs.lz4",
        "configuration": {
            "acceleration": 1
        }
    }
    ...
]
</code></pre>
<p>The configuration can be represented by a simple struct:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// `lz4` codec configuration parameters
#[derive(Serialize, Deserialize, Clone, Eq, PartialEq, Debug, Display)]
pub struct Lz4CodecConfiguration {
    pub acceleration: i32
}
<span class="boring">}</span></code></pre></pre>
<p>Note that codec configurations in <a href="https://docs.rs/zarrs_metadata/latest/zarrs_metadata/"><code>zarrs_metadata</code></a> are versioned so that they can adapt to potential codec specification revisions.</p>
<p><code>Lz4CodecConfiguration</code> is JSON serialisable, so implement the <code>ConfigurationSerialize</code> trait:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl ConfigurationSerialize for Lz4CodecConfiguration {}
<span class="boring">}</span></code></pre></pre>
<p>This trait requires <code>Serialize + DeserializeOwned</code>, and enables any implementing struct to be infallibly converted from a JSON object or anything convertible to a JSON object.
A codec configuration must not be able to hold unrepresentable JSON state, otherwise such a conversion could panic at runtime.</p>
<h3 id="the-lz4codec-struct"><a class="header" href="#the-lz4codec-struct">The <code>Lz4Codec</code> Struct</a></h3>
<p>Now create the codec struct.
For encoding, the <code>acceleration</code> needs to be known, so this must be a field of the struct:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Lz4Codec {
    acceleration: i32
}
<span class="boring">}</span></code></pre></pre>
<p>Next we define two constructors.
These are not officially required for the codec to be used, but it is common practice in <code>zarrs</code> to include constructors based on the underlying codec parameters as well as a constructor from configuration.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Lz4Codec {
    #[must_use]
    pub fn new(acceleration: i32) -&gt; Self {
        Self { acceleration }
    }

    #[must_use]
    pub fn new_with_configuration(
        configuration: &amp;Lz4CodecConfiguration,
    ) -&gt; Self {
        Self { acceleration: configuration.acceleration }
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="codectraits"><a class="header" href="#codectraits"><code>CodecTraits</code></a></h3>
<p>Now we implement the <code>CodecTraits</code>, which are required for every codec.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// Unique identifier for the LZ4 codec
pub const LZ4: &amp;str = "example.lz4";

impl CodecTraits for Lz4Codec {
    /// Unique identifier for the codec.
    fn identifier(&amp;self) -&gt; &amp;str {
        LZ4
    }

    /// Create the codec configuration.
    fn configuration_opt(
        &amp;self,
        _name: &amp;str,
        _options: &amp;CodecMetadataOptions,
    ) -&gt; Option&lt;Configuration&gt; {
        // The into comes from the auto implementation of From&lt;T: ConfigurationSerialize&gt; for Configuration
        Some(Lz4CodecConfiguration::new(self.acceleration).into())
    }

    /// Indicates if the input to a codecs partial decoder should be cached for optimal performance.
    /// If true, a cache may be inserted *before* it in a [`CodecChain`] partial decoder.
    fn partial_decoder_should_cache_input(&amp;self) -&gt; bool {
        false
    }

    /// Indicates if a partial decoder decodes all bytes from its input handle and its output should be cached for optimal performance.
    /// If true, a cache will be inserted at some point *after* it in a [`CodecChain`] partial decoder.
    fn partial_decoder_decodes_all(&amp;self) -&gt; bool {
        true
    }
}
<span class="boring">}</span></code></pre></pre>
<p>A unique identifier is defined for the LZ4 codec, which is chosen as to not conflict with a potential future codec that may be implemented in <code>zarrs</code> itself (likely <code>lz4</code>).
This is returned by the <code>identifier()</code> method.
The identifier is used in codec registration, and enables features such as renaming of codecs for serialisation, and supporting multiple codec aliases.</p>
<p>The <code>configuration_opt</code> method creates the codec configuration.
Note that this takes a <code>name</code> and <code>options</code> which are typically unneeded.
However, there are cases where the configuration may be dependent on the codec <code>name</code>, or a runtime option could impact serialisation behaviour.</p>
<p>While the <code>lz4</code> codec may actually support partial decoding, this needs to be implemented by the wrapper (and it may not be efficient anyway, depending on the access pattern).
For simplicity in this example, let us indicate that partial decoding is NOT supported and make <code>partial_decoder_decodes_all()</code> return <code>true</code>.
This ensures that a cache is inserted at the appropriate location in a partial decoder codec chain.</p>
<h3 id="bytestobytescodectraits"><a class="header" href="#bytestobytescodectraits"><code>BytesToBytesCodecTraits</code></a></h3>
<p>The <code>BytesToBytesCodecTraits</code> are where the encoding and decoding methods are implemented.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl BytesToBytesCodecTraits for BloscCodec {
    /// Return a dynamic version of the codec.
    fn into_dyn(self: Arc&lt;Self&gt;) -&gt; Arc&lt;dyn BytesToBytesCodecTraits&gt; {
        self as Arc&lt;dyn BytesToBytesCodecTraits&gt;
    }

    /// Return the maximum internal concurrency supported for the requested decoded representation.
    fn recommended_concurrency(
        &amp;self,
        _decoded_representation: &amp;BytesRepresentation,
    ) -&gt; Result&lt;RecommendedConcurrency, CodecError&gt; {
        Ok(RecommendedConcurrency::new_maximum(1))
    }

    /// Returns the size of the encoded representation given a size of the decoded representation.
    fn encoded_representation(
        &amp;self,
        decoded_representation: &amp;BytesRepresentation,
    ) -&gt; BytesRepresentation {
        todo!()
    }

    fn encode&lt;'a&gt;(
        &amp;self,
        decoded_value: RawBytes&lt;'a&gt;,
        _options: &amp;CodecOptions,
    ) -&gt; Result&lt;RawBytes&lt;'a&gt;, CodecError&gt; {
        todo!()
    }

    fn decode&lt;'a&gt;(
        &amp;self,
        encoded_value: RawBytes&lt;'a&gt;,
        _decoded_representation: &amp;BytesRepresentation,
        _options: &amp;CodecOptions,
    ) -&gt; Result&lt;RawBytes&lt;'a&gt;, CodecError&gt; {
        todo!()
    }
}
<span class="boring">}</span></code></pre></pre>
<p>In the above example, the encode and decode methods have been left as an exercise to the reader.
A crate like <a href="https://crates.io/crates/lz4"><code>lz4</code></a> could be used to implement these methods with only a few lines in each method.</p>
<p>The encoded representation of an <strong>array-to-bytes</strong> or <strong>bytes-to-bytes</strong> filter is a <a href="https://docs.rs/zarrs/latest/zarrs/array/enum.BytesRepresentation.html"><code>BytesRepresentation</code></a>, which is either <code>Fixed</code>, <code>Bounded</code>, or <code>Unbounded</code>.
Typically compression codecs like <code>lz4</code> have an upper bound on the compressed size (see See <a href="https://github.com/lz4/lz4/blob/fa1634e2ccd41ac09c087ab65e96bcbbd003fd20/lib/lz4.h#L217-L226"><code>LZ4_compressBound</code></a>), so the <code>encoded_representation()</code> should return a <code>BytesRepresentation::BoundedSize</code> (unless the proceeding filter outputs an unbounded size).
This has been left as an exercise for the reader.</p>
<h4 id="codec-parallelism"><a class="header" href="#codec-parallelism">Codec Parallelism</a></h4>
<p>In the above snippet, the <code>recommended_concurrency</code> is set to 1.
This indicates to higher level <code>zarrs</code> operations that the codec <code>encode</code>/<code>decode</code> operations will only use one thread and that <code>zarrs</code> should use <em>chunk parallelism</em> over <em>codec parallelism</em>.
For large chunks, it may be preferable to use <em>codec parallelism</em>, and this can be achieved by increasing the recommended concurrency and using multithreading in the <code>encode</code>/<code>decode</code> methods.
However, the cost of multithreading in external libraries can be expensive, so benchmark this!
For example, the <code>blosc</code> codec in <code>zarrs</code> activates <em>codec parallelism</em> when the chunk size is greater than <code>4 MB</code>.</p>
<h4 id="partial-encoding--decoding"><a class="header" href="#partial-encoding--decoding">Partial Encoding / Decoding</a></h4>
<p>Note that the <code>[async_]partial_decoder</code> and <code>[async_]partial_encoder</code> methods of <code>BytesToBytesCodecTraits</code> are not implemented in the above example, and the default implementations encode/decode the entire chunk.
Partial encoding is not applicable to the <code>lz4</code> codec, but it <em>could</em> support partial decoding.
The <code>blosc</code> codec in <code>zarrs</code> is an example of partial decoding.
The input is always fully decoded (and is cached because <code>partial_decoder_should_cache_input()</code> returns <code>true</code>), but only requested byte ranges are decompressed.</p>
<h3 id="codec-registration"><a class="header" href="#codec-registration">Codec Registration</a></h3>
<p><code>zarrs</code> uses <a href="https://crates.io/crates/inventory"><code>inventory</code></a> for compile time registration of codecs.
Registration involves creating a method that is used to check if the identifier is a match, and a function that actually creates the codec from a configuration.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Register the codec.
inventory::submit! {
    CodecPlugin::new(LZ4, is_identifier_lz4, create_codec_lz4)
}

fn is_identifier_lz4(identifier: &amp;str) -&gt; bool {
    identifier == LZ4
}

pub(crate) fn create_codec_lz4(metadata: &amp;MetadataV3) -&gt; Result&lt;Codec, PluginCreateError&gt; {
    let configuration: Lz4Codec = metadata
        .to_configuration()
        .map_err(|_| PluginMetadataInvalidError::new(LZ4, "codec", metadata.clone()))?;
    let codec = Arc::new(Lz4Codec::new_with_configuration(&amp;configuration)?);
    Ok(Codec::BytesToBytes(codec))
}
<span class="boring">}</span></code></pre></pre>
<h3 id="codec-aliasing"><a class="header" href="#codec-aliasing">Codec Aliasing</a></h3>
<p>By default, the codec <code>name</code> will be the codec <code>identifier()</code>, however that may not be desirable (especially with <code>example.lz4</code>!).</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(Lz4::new(1).default_name(), "example.lz4");
<span class="boring">}</span></code></pre></pre>
<p><code>zarrs</code> includes a mechanism for setting the serialised <code>name</code> of codecs, as well as supported <code>name</code> aliases for decoding.
By default, <code>zarrs</code> will preserve the alias if an array is rewritten, but this can be changed (see the <code>zarrs</code> global config).</p>
<p>If the codec is confirmed to be fully compatible with <code>numcodecs.lz4</code>, its default name could be changed with a runtime configuration:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>global_config_mut()
    .codec_aliases_v3_mut()
    .default_names
    .entry(LZ4.into())
    .and_modify(|entry| {
        *entry = "numcodecs.lz4".into();
    });
assert_eq!(Lz4::new(1).default_name(), "numcodecs.lz4");
<span class="boring">}</span></code></pre></pre>
<p>Or the <code>identifier</code> could just be changed to <code>numcodecs.lz4</code>, for example.</p>
<h3 id="ready-to-test"><a class="header" href="#ready-to-test">Ready to Test</a></h3>
<p>At this point, the <code>lz4</code> is ready to go and could be tested for compatibility against <code>numcodecs.lz4</code> in <code>zarr-python</code>.</p>
<p>This codec would be a great candidate for merging into <code>zarrs</code> itself.
Using the <code>lz4</code> identifier would be recommended in this case and the default name would be set to <code>numcodecs.lz4</code> by default.
If <code>lz4</code> were ever standardised without a <code>numcodecs.</code> prefix, then the default name could be <code>lz4</code> but an alias would remain for <code>numcodecs.lz4</code>.</p>
<h2 id="array-to-array-and-array-to-bytes-codecs"><a class="header" href="#array-to-array-and-array-to-bytes-codecs">Array-to-Array and Array-to-Bytes Codecs</a></h2>
<p>Implementing an <strong>Array-to-Array</strong> or <strong>Array-to-Bytes</strong> codec is similar, but the <code>ArrayCodecTraits</code> and <code>ArraytoArrayCodecTraits</code> or <code>ArrayToBytesCodecTraits</code> must be implemented too.</p>
<h3 id="arraycodectraits"><a class="header" href="#arraycodectraits"><code>ArrayCodecTraits</code></a></h3>
<p><a href="https://docs.rs/zarrs/latest/zarrs/array/codec/trait.ArrayCodecTraits.html"><code>ArrayCodecTraits</code></a> has two methods.</p>
<p><strong><code>recommended_concurrency()</code></strong> (Required)</p>
<p>This method differs from that of <code>BytesToBytesCodecTraits</code> only in the type of the <code>decoded_representation</code> parameter.
It takes a <a href="https://docs.rs/zarrs/latest/zarrs/array/type.ChunkRepresentation.html"><code>ChunkRepresentation</code></a> which holds a chunk shape, data type, and fill value.</p>
<p><strong><code>partial_decode_granularity()</code></strong> (Provided)</p>
<p>Returns the shape of the smallest subset of a chunk that can be efficiently decoded if the chunk were subdivided into a regular grid.
For most codecs, this is just the shape of the chunk.
It is the shape of the "inner chunks" for the sharding codec.
The default implementation just returns the chunk shape.</p>
<h3 id="arraytoarraycodectraits"><a class="header" href="#arraytoarraycodectraits"><code>ArrayToArrayCodecTraits</code></a></h3>
<p>This trait is similar to <code>BytesToBytesCodecTraits</code> except the <code>encode</code> and <code>decode</code> methods input and return <a href="https://docs.rs/zarrs/latest/zarrs/array/enum.ArrayBytes.html"><code>ArrayBytes</code></a>, which can represent arrays with fixed or variable sized elements.</p>
<p>Key methods beyond <code>encode</code> and <code>decode</code> are:</p>
<ul>
<li><code>encoded_data_type()</code> (required).
<ul>
<li>This is where a codec can put an input data type compatibility check and indicate if the data type changes on encoding.</li>
</ul>
</li>
<li><code>encoded_fill_value()</code> (provided) Defaults to the input fill value.</li>
<li><code>encoded_shape()</code> (provided) Defaults to the input shape.</li>
<li><code>decoded_shape()</code> (provided) Defaults to the input shape.</li>
<li><code>encoded_representation()</code> (provided) Creates a <code>ChunkRepresentation</code> from the output of <code>encoded_{data_type,fill_value,shape}()</code></li>
</ul>
<p>Default implementations are provided for <code>[async_]partial_{encoder,decoder}</code> which encode/decode the entire chunk.</p>
<h3 id="arraytobytescodectraits"><a class="header" href="#arraytobytescodectraits"><code>ArrayToBytesCodecTraits</code></a></h3>
<p>This trait has a required <code>encoded_representation()</code> method that returns a a <code>BytesRepresentation</code> based on <code>ChunkRepresentation</code> parameter.
The <code>decode()</code> and <code>encode()</code> methods transform between <a href="https://docs.rs/zarrs/latest/zarrs/array/enum.ArrayBytes.html"><code>ArrayBytes</code></a> and <a href="https://docs.rs/zarrs/latest/zarrs/array/type.RawBytes.html"><code>RawBytes</code></a>.</p>
<h2 id="custom-data-type-interaction"><a class="header" href="#custom-data-type-interaction">Custom Data Type Interaction</a></h2>
<p>The next page deals with custom data types, however it is worth highlighting that third party codecs are expected to handle custom data types internally.</p>
<p>A first party codec may extend <code>DataTypeExtension</code> with a new <code>codec_&lt;CODEC_NAME&gt;</code> method and a new <code>DataTypeExtension&lt;CodecName&gt;</code> trait to enable a codec to be used with custom data types.
Currently <code>zarrs</code> has data type extension traits for the <code>bytes</code> and <code>packbits</code> codecs.
All other codecs are either data type agnostic (e.g. <code>transpose</code>, compression codecs, etc.) or operate on a specific set of data types (e.g. <code>zfp</code>).</p>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>If the need arises, <code>DataTypeExtension</code> may be changed in the future to better support interaction between custom data types and custom codecs.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="data-type-extensions"><a class="header" href="#data-type-extensions">Data Type Extensions</a></h1>
<p>According to the Zarr V3 specification:</p>
<blockquote>
<p>A data type defines the set of possible values that an array may contain.
For example, the 32-bit signed integer data type defines binary representations for all integers in the range −2,147,483,648 to 2,147,483,647.</p>
</blockquote>
<p>The specification defines a limited set of data types, but additional data types can be defined as extensions.</p>
<p><code>zarrs</code> supports a number of extension data types, many of which are registered in the <a href="https://github.com/zarr-developers/zarr-extensions"><code>zarr-extensions</code></a> repository.
This chapter explains how to create custom data types with a guided walkthrough.</p>
<h2 id="example-the-uint4-data-type"><a class="header" href="#example-the-uint4-data-type">Example: The <code>uint4</code> Data type</a></h2>
<p>The <code>uint4</code> data type is registered at the <a href="https://github.com/zarr-developers/zarr-extensions"><code>zarr-extensions</code></a> repository.
The specification can be read here:</p>
<ul>
<li><a href="https://github.com/zarr-developers/zarr-extensions/tree/main/data-types/uint4">https://github.com/zarr-developers/zarr-extensions/tree/main/data-types/uint4</a></li>
</ul>
<p>In summary, it defines a 4-bit unsigned integer in the range <code>[0, 15]</code> that is supported by the <code>bytes</code> and <code>packbits</code> codecs.</p>
<h3 id="the-datatypeuint4-struct"><a class="header" href="#the-datatypeuint4-struct">The <code>DataTypeUint4</code> Struct</a></h3>
<p>The <code>uint4</code> data type has no configuration, so it can be represented by a unit struct:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// The `uint4` data type.
#[derive(Debug)]
struct DataTypeUint4;
<span class="boring">}</span></code></pre></pre>
<h3 id="implementing-datatypeextension"><a class="header" href="#implementing-datatypeextension">Implementing <code>DataTypeExtension</code></a></h3>
<p>To be used as a data type extension, <code>DataTypeUint4</code> must implement the <code>DataTypeExtension</code> trait.
The <code>DataTypeUint4Element</code> used in these definitions is defined later on this page.
This defines properties of the data type such as the metadata (name and configuration), size, and conversion between to and from fill values and fill value metadata.
It has additional codec related methods detailed shortly.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// A unique identifier for `uint4` data type.
const UINT4: &amp;'static str = "uint4";

impl DataTypeExtension for DataTypeUint4 {
    fn name(&amp;self) -&gt; String {
        UINT4.to_string()
    }

    fn configuration(&amp;self) -&gt; Configuration {
        Configuration::default()
    }

    fn fill_value(
        &amp;self,
        fill_value_metadata: &amp;FillValueMetadataV3,
    ) -&gt; Result&lt;FillValue, DataTypeFillValueMetadataError&gt; {
        let err = || DataTypeFillValueMetadataError::new(self.name(), fill_value_metadata.clone());
        let element_metadata: u64 = fill_value_metadata.as_u64().ok_or_else(err)?;
        let element = DataTypeUint4Element::try_from(element_metadata).map_err(|_| {
            DataTypeFillValueMetadataError::new(UINT4.to_string(), fill_value_metadata.clone())
        })?;
        Ok(FillValue::new(element.to_ne_bytes().to_vec()))
    }

    fn metadata_fill_value(
        &amp;self,
        fill_value: &amp;FillValue,
    ) -&gt; Result&lt;FillValueMetadataV3, DataTypeFillValueError&gt; {
        let element = DataTypeUint4Element::from_ne_bytes(
            fill_value
                .as_ne_bytes()
                .try_into()
                .map_err(|_| DataTypeFillValueError::new(self.name(), fill_value.clone()))?,
        );
        Ok(FillValueMetadataV3::from(element.as_u8()))
    }

    fn size(&amp;self) -&gt; zarrs::array::DataTypeSize {
        DataTypeSize::Fixed(1)
    }
    
    ...
}
<span class="boring">}</span></code></pre></pre>
<h3 id="implementing-datatypeextensionbytescodec"><a class="header" href="#implementing-datatypeextensionbytescodec">Implementing <code>DataTypeExtensionBytesCodec</code></a></h3>
<p>Supporting the <code>bytes</code> codec is absolutely trivial for the <code>uint4</code> data type.
It simply passes through the in-memory data unmodified, since it is already a 1-byte value.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl DataTypeExtensionBytesCodec for DataTypeUint4 {
    fn encode&lt;'a&gt;(
        &amp;self,
        bytes: std::borrow::Cow&lt;'a, [u8]&gt;,
        _endianness: Option&lt;zarrs_metadata::Endianness&gt;,
    ) -&gt; Result&lt;std::borrow::Cow&lt;'a, [u8]&gt;, DataTypeExtensionBytesCodecError&gt; {
        Ok(bytes)
    }

    fn decode&lt;'a&gt;(
        &amp;self,
        bytes: std::borrow::Cow&lt;'a, [u8]&gt;,
        _endianness: Option&lt;zarrs_metadata::Endianness&gt;,
    ) -&gt; Result&lt;std::borrow::Cow&lt;'a, [u8]&gt;, DataTypeExtensionBytesCodecError&gt; {
        Ok(bytes)
    }
}
<span class="boring">}</span></code></pre></pre>
<p>The default implementation of <code>DataTypeExtension::codec_bytes</code> must be overriden to return <code>Ok(self)</code>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl DataTypeExtension for DataTypeUint4 {
    ...
    
    fn codec_bytes(&amp;self) -&gt; Result&lt;&amp;dyn DataTypeExtensionBytesCodec, DataTypeExtensionError&gt; {
        Ok(self)
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="implementing-datatypeextensionpackbitscodec"><a class="header" href="#implementing-datatypeextensionpackbitscodec">Implementing <code>DataTypeExtensionPackBitsCodec</code></a></h3>
<p>The <code>uint4</code> data type supports the <code>packbits</code> codec as a 4-bit value.
This can be supported by implementing the <code>DataTypeExtensionPackBitsCodec</code> trait.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl DataTypeExtensionPackBitsCodec for DataTypeUint4 {
    fn component_size_bits(&amp;self) -&gt; u64 {
        4
    }

    fn num_components(&amp;self) -&gt; u64 {
        1
    }

    fn sign_extension(&amp;self) -&gt; bool {
        false
    }
}
<span class="boring">}</span></code></pre></pre>
<p>In this case, the trait methods signify that the data type:</p>
<ul>
<li>has 1 component,</li>
<li>a component size of 4 bits, and</li>
<li>it is unsigned and does not need sign extension.</li>
</ul>
<p>The default implementation of <code>DataTypeExtension::codec_packbits</code> must be overriden to return <code>Ok(self)</code>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl DataTypeExtension for DataTypeUint4 {
    ...
    
    fn codec_packbits(
        &amp;self,
    ) -&gt; Result&lt;&amp;dyn DataTypeExtensionPackBitsCodec, DataTypeExtensionError&gt; {
        Ok(self)
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="registering-the-uint4-data-type"><a class="header" href="#registering-the-uint4-data-type">Registering the <code>uint4</code> Data Type</a></h3>
<p>A data type must be registered as a <code>DataTypePlugin</code> to be used in an <code>Array</code>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>// Register the data type so that it can be recognised when opening arrays.
inventory::submit! {
    DataTypePlugin::new(UINT4, is_uint4_dtype, create_uint4_dtype)
}

fn is_uint4_dtype(name: &amp;str) -&gt; bool {
    name == UINT4
}

fn create_uint4_dtype(
    metadata: &amp;MetadataV3,
) -&gt; Result&lt;Arc&lt;dyn DataTypeExtension&gt;, PluginCreateError&gt; {
    if metadata.configuration_is_none_or_empty() {
        Ok(Arc::new(DataTypeUint4))
    } else {
        Err(PluginMetadataInvalidError::new(UINT4, "data_type", metadata.to_string()).into())
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="the-datatypeuint4element-struct"><a class="header" href="#the-datatypeuint4element-struct">The <code>DataTypeUint4Element</code> Struct</a></h3>
<p>The most suitable in-memory representation of a <code>uint4</code> data type element is a <code>u8</code>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// The in-memory representation of the `uint4` data type.
#[derive(Deserialize, Clone, Copy, Debug, PartialEq)]
struct DataTypeUint4Element(u8);
<span class="boring">}</span></code></pre></pre>
<p>A data type element must implement the <code>Element</code> trait to be used in <code>Array::store_*_as_elements</code> methods.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// This defines how an in-memory DataTypeUint4 is converted into ArrayBytes before encoding via the codec pipeline.
impl Element for DataTypeUint4 {
    fn validate_data_type(data_type: &amp;DataType) -&gt; Result&lt;(), ArrayError&gt; {
        (data_type == &amp;DataType::Extension(Arc::new(DataTypeUint4)))
            .then_some(())
            .ok_or(ArrayError::IncompatibleElementType)
    }

    fn into_array_bytes&lt;'a&gt;(
        data_type: &amp;DataType,
        elements: &amp;'a [Self],
    ) -&gt; Result&lt;zarrs::array::ArrayBytes&lt;'a&gt;, ArrayError&gt; {
        Self::validate_data_type(data_type)?;
        // Maybe this could be a transmute instead &amp;[DataTypeUint4(u8)] -&gt; Cow::Borrowed(&amp;[u8])
        let mut bytes: Vec&lt;u8&gt; =
            Vec::with_capacity(elements.len() * size_of::&lt;DataTypeUint4&gt;());
        for element in elements {
            bytes.push(element.0);
        }
        Ok(ArrayBytes::Fixed(Cow::Owned(bytes)))
    }
}
<span class="boring">}</span></code></pre></pre>
<p>A data type element must implement the <code>ElementOwned</code> trait to be used in <code>Array::retrieve_*_as_elements</code> methods.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// This defines how ArrayBytes are converted into a DataTypeUint4 after decoding via the codec pipeline.
impl ElementOwned for DataTypeUint4 {
    fn from_array_bytes(
        data_type: &amp;DataType,
        bytes: ArrayBytes&lt;'_&gt;,
    ) -&gt; Result&lt;Vec&lt;Self&gt;, ArrayError&gt; {
        Self::validate_data_type(data_type)?;
        let bytes = bytes.into_fixed()?;
        let bytes_len = bytes.len();
        let mut elements = Vec::with_capacity(bytes_len / size_of::&lt;DataTypeUint4&gt;());
        for byte in bytes.iter() {
            // TODO: Should not construct DataTypeUint4 this way as it could represent a
            // value outside of [0, 15]. Set upper bits in the byte to 0?
            elements.push(DataTypeUint4(*byte))
        }
        Ok(elements)
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Some non-essential utility methods were defined for <code>DataTypeUint4</code> and used in the snippets above:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl DataTypeUint4 {
    fn to_ne_bytes(&amp;self) -&gt; [u8; 1] {
        [self.0]
    }

    fn from_ne_bytes(bytes: &amp;[u8; 1]) -&gt; Self {
        Self(bytes[0])
    }

    fn as_u8(&amp;self) -&gt; u8 {
        self.0
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="more-examples"><a class="header" href="#more-examples">More Examples</a></h2>
<p>The <code>zarrs</code> repository includes multiple custom data type examples:</p>
<ul>
<li><a href="https://github.com/zarrs/zarrs/blob/main/zarrs/examples/custom_data_type_uint12.rs">custom_data_type_uint12.rs</a></li>
<li><a href="https://github.com/zarrs/zarrs/blob/main/zarrs/examples/custom_data_type_uint4.rs">custom_data_type_uint4.rs</a></li>
<li><a href="https://github.com/zarrs/zarrs/blob/main/zarrs/examples/custom_data_type_float8_e3m4.rs">custom_data_type_float8_e3m4.rs</a></li>
<li><a href="https://github.com/zarrs/zarrs/blob/main/zarrs/examples/custom_data_type_fixed_size.rs">custom_data_type_fixed_size.rs</a></li>
<li><a href="https://github.com/zarrs/zarrs/blob/main/zarrs/examples/custom_data_type_variable_size.rs">custom_data_type_variable_size.rs</a></li>
</ul>
<h2 id="contributing-new-data-types-to-zarrs"><a class="header" href="#contributing-new-data-types-to-zarrs">Contributing New Data Types to <code>zarrs</code></a></h2>
<p>The <a href="https://github.com/zarr-developers/zarr-extensions"><code>zarr-extensions</code></a> repository is always growing with new Zarr extensions.
The conformance of <code>zarrs</code> to <a href="https://github.com/zarr-developers/zarr-extensions"><code>zarr-extensions</code></a> is tracked in this issue:</p>
<ul>
<li><a href="https://github.com/zarrs/zarrs/issues/191">https://github.com/zarrs/zarrs/issues/191</a></li>
</ul>
<p>Contributions are welcomed to support additional data types.
With a little bit of polish, the <code>uint4</code> example above could be included in <code>zarrs</code> itself (if it isn't already)!</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h3 id="zarrs_tools"><a class="header" href="#zarrs_tools"><code>zarrs_tools</code> <a href="https://crates.io/crates/zarrs_tools"><img src="https://img.shields.io/crates/v/zarrs_tools.svg" alt="zarrs_tools_ver" /></a> <a href="https://docs.rs/zarrs_tools"><img src="https://docs.rs/zarrs_tools/badge.svg" alt="zarrs_tools_doc" /></a></a></h3>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarrs_reencode"><a class="header" href="#zarrs_reencode">zarrs_reencode</a></h1>
<p>Reencode/rechunk a Zarr V2/V3 to a Zarr v3 array.</p>
<h2 id="installation-1"><a class="header" href="#installation-1">Installation</a></h2>
<p><code>zarrs_reencode</code> packaged by default with <code>zarrs_tools</code> and requires no extra features.</p>
<h3 id="prebuilt-binaries"><a class="header" href="#prebuilt-binaries">Prebuilt Binaries</a></h3>
<pre><code class="language-bash"># Requires cargo-binstall https://github.com/cargo-bins/cargo-binstall
cargo binstall zarrs_tools
</code></pre>
<h3 id="from-source"><a class="header" href="#from-source">From Source</a></h3>
<pre><code class="language-bash">cargo install zarrs_tools
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<details>
<summary>zarrs_reencode --help</summary>
<pre><code class="language-text">Reencode a Zarr array

Usage: zarrs_reencode [OPTIONS] &lt;PATH_IN&gt; &lt;PATH_OUT&gt;

Arguments:
  &lt;PATH_IN&gt;
          The zarr array input path or URL

  &lt;PATH_OUT&gt;
          The zarr array output directory

Options:
  -d, --data-type &lt;DATA_TYPE&gt;
          The data type as a string
          
          Valid data types:
            - bool
            - int8, int16, int32, int64
            - uint8, uint16, uint32, uint64
            - float16, float32, float64, bfloat16
            - complex64, complex 128
            - r* (raw bits, where * is a multiple of 8)

  -f, --fill-value &lt;FILL_VALUE&gt;
          Fill value. See &lt;https://zarr-specs.readthedocs.io/en/latest/v3/core/v3.0.html#fill-value&gt;
          
          The fill value must be compatible with the data type.
          
          Examples:
            int/uint: 0 100 -100
            float: 0.0 "NaN" "Infinity" "-Infinity"
            r*: "[0, 255]"

      --separator &lt;SEPARATOR&gt;
          The chunk key encoding separator. Either . or /

  -c, --chunk-shape &lt;CHUNK_SHAPE&gt;
          Chunk shape. A comma separated list of the chunk size along each array dimension.
          
          If any dimension has size zero, it will be set to match the array shape.

  -s, --shard-shape &lt;SHARD_SHAPE&gt;
          Shard shape. A comma separated list of the shard size along each array dimension.
          
          If specified, the array is encoded using the sharding codec.
          If any dimension has size zero, it will be set to match the array shape.

      --array-to-array-codecs &lt;ARRAY_TO_ARRAY_CODECS&gt;
          Array to array codecs.
          
          JSON holding an array of array to array codec metadata.
          
          Examples:
            '[ { "name": "transpose", "configuration": { "order": [0, 2, 1] } } ]'
            '[ { "name": "bitround", "configuration": { "keepbits": 9 } } ]'

      --array-to-bytes-codec &lt;ARRAY_TO_BYTES_CODEC&gt;
          Array to bytes codec.
          
          JSON holding array to bytes codec metadata.
          
          Examples:
            '{ "name": "bytes", "configuration": { "endian": "little" } }'
            '{ "name": "pcodec", "configuration": { "level": 12 } }'
            '{ "name": "zfp", "configuration": { "mode": "fixedprecision", "precision": 19 } }'

      --bytes-to-bytes-codecs &lt;BYTES_TO_BYTES_CODECS&gt;
          Bytes to bytes codecs.
          
          JSON holding an array bytes to bytes codec configurations.
          
          Examples:
            '[ { "name": "blosc", "configuration": { "cname": "blosclz", "clevel": 9, "shuffle": "bitshuffle", "typesize": 2, "blocksize": 0 } } ]'
            '[ { "name": "bz2", "configuration": { "level": 9 } } ]'
            '[ { "name": "crc32c" } ]'
            '[ { "name": "gzip", "configuration": { "level": 9 } } ]'
            '[ { "name": "zstd", "configuration": { "level": 22, "checksum": false } } ]'

      --dimension-names &lt;DIMENSION_NAMES&gt;
          Dimension names (optional). Comma separated.

      --attributes &lt;ATTRIBUTES&gt;
          Attributes (optional).
          
          JSON holding array attributes.

      --attributes-append &lt;ATTRIBUTES_APPEND&gt;
          Attributes to append (optional).
          
          JSON holding array attributes.

      --concurrent-chunks &lt;CONCURRENT_CHUNKS&gt;
          Number of concurrent chunks

      --ignore-checksums
          Ignore checksums.
          
          If set, checksum validation in codecs (e.g. crc32c) is skipped.

      --validate
          Validate written data

  -v, --verbose
          Print verbose information, such as the array header

      --cache-size &lt;CACHE_SIZE&gt;
          An optional chunk cache size (in bytes)

      --cache-chunks &lt;CACHE_CHUNKS&gt;
          An optional chunk cache size (in chunks)

      --cache-size-thread &lt;CACHE_SIZE_THREAD&gt;
          An optional per-thread chunk cache size (in bytes)

      --cache-chunks-thread &lt;CACHE_CHUNKS_THREAD&gt;
          An optional per-thread chunk cache size (in chunks)

      --write-shape &lt;WRITE_SHAPE&gt;
          Write shape (optional). A comma separated list of the write size along each array dimension.
          
          Use this parameter to incrementally write shards in batches of chunks of the specified write shape.
          The write shape defaults to the shard shape for sharded arrays.
          This parameter is ignored for unsharded arrays (the write shape is the chunk shape).
          
          Prefer to set the write shape to an integer multiple of the chunk shape to avoid unnecessary reads.

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
</details>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>Reencode <code>array.zarr</code> (<code>uint16</code>) with:</p>
<ul>
<li>a chunk shape of [32, 32, 32],</li>
<li>a shard shape of [128, 128, 0]
<ul>
<li>the last dimension of the shard shape will match the array shape to the nearest multiple of the chunk shape</li>
</ul>
</li>
<li>level 9 blosclz compression with bitshuffling</li>
<li>an input chunk cache with a size of 1GB</li>
</ul>
<pre><code class="language-bash">zarrs_reencode \
--cache-size 1000000000 \
--chunk-shape 32,32,32 \
--shard-shape 128,128,0 \
--bytes-to-bytes-codecs '[ { "name": "blosc", "configuration": { "cname": "blosclz", "clevel": 9, "shuffle": "bitshuffle", "typesize": 2, "blocksize": 0 } } ]' \
array.zarr array_reencode.zarr
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarrs_ome"><a class="header" href="#zarrs_ome">zarrs_ome</a></h1>
<p>Convert a Zarr array to an <a href="https://ngff.openmicroscopy.org/0.5/index.html">OME-Zarr</a> 0.5 multiscales hierarchy.</p>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p>Conformance with the OME-Zarr 0.5 specification is not guaranteed, and input validation is limited.
For example, it is possible to create multiscale arrays with nonconformant axis ordering.</p>
</div>
<p><code>zarrs_ome</code> creates a multi-resolution Zarr V3 array through various methods:</p>
<ul>
<li>Gaussian image pyramid</li>
<li>Mean downsampling</li>
<li>Mode downsampling (for discrete data)</li>
</ul>
<p>The downsample factor defaults to 2 on all axes (careful if data includes channels!).
The physical size and units of the array elements can be set explicitly.
The array can be reencoded when output to OME-Zarr.</p>
<h2 id="installation-2"><a class="header" href="#installation-2">Installation</a></h2>
<p><code>zarrs_ome</code> is installed with the <code>ome</code> feature of <code>zarrs_tools</code>.</p>
<h3 id="prebuilt-binaries-1"><a class="header" href="#prebuilt-binaries-1">Prebuilt Binaries</a></h3>
<pre><code class="language-bash"># Requires cargo-binstall https://github.com/cargo-bins/cargo-binstall
cargo binstall zarrs_tools
</code></pre>
<h3 id="from-source-1"><a class="header" href="#from-source-1">From Source</a></h3>
<pre><code class="language-bash">cargo install --features=ome zarrs_tools
</code></pre>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<details>
<summary>zarrs_ome --help</summary>
<pre><code class="language-text">Convert a Zarr array to an OME-Zarr multiscales hierarchy

Usage: zarrs_ome [OPTIONS] &lt;INPUT&gt; &lt;OUTPUT&gt; [DOWNSAMPLE_FACTOR]...

Arguments:
  &lt;INPUT&gt;
          The input array path

  &lt;OUTPUT&gt;
          The output group path

  [DOWNSAMPLE_FACTOR]...
          The downsample factor per axis, comma separated.
          
          Defaults to 2 on each axis.

Options:
      --ome-zarr-version &lt;OME_ZARR_VERSION&gt;
          [default: 0.5]

          Possible values:
          - 0.5: https://ngff.openmicroscopy.org/0.5/

      --max-levels &lt;MAX_LEVELS&gt;
          Maximum number of downsample levels
          
          [default: 10]

      --physical-size &lt;PHYSICAL_SIZE&gt;
          Physical size per axis, comma separated

      --physical-units &lt;PHYSICAL_UNITS&gt;
          Physical units per axis, comma separated.
          
          Set to "channel" for a channel axis.

      --name &lt;NAME&gt;
          OME Zarr dataset name

      --discrete
          Set to true for discrete data.
          
          Performs majority downsampling instead of creating a Gaussian image pyramid or mean downsampling.

      --gaussian-sigma &lt;GAUSSIAN_SIGMA&gt;
          The Gaussian "sigma" to apply when creating a Gaussian image pyramid per axis, comma separated.
          
          This is typically set to 0.5 times the downsample factor for each axis. If omitted, then mean downsampling is applied.
          
          Ignored for discrete data.

      --gaussian-kernel-half-size &lt;GAUSSIAN_KERNEL_HALF_SIZE&gt;
          The Gaussian kernel half size per axis, comma separated.
          
          If omitted, defaults to ceil(3 * sigma).
          
          Ignored for discrete data or if --gaussian-sigma is not set.

      --exists &lt;EXISTS&gt;
          Behaviour if the output exists
          
          [default: erase]

          Possible values:
          - erase:     Erase the output
          - overwrite: Overwrite existing files. Useful if the output includes additional non-zarr files to be preserved. May fail if changing the encoding
          - exit:      Exit if the output already exists

      --group-attributes &lt;GROUP_ATTRIBUTES&gt;
          Attributes (optional).
          
          JSON holding group attributes.

  -d, --data-type &lt;DATA_TYPE&gt;
          The data type as a string
          
          Valid data types:
            - bool
            - int8, int16, int32, int64
            - uint8, uint16, uint32, uint64
            - float16, float32, float64, bfloat16
            - complex64, complex 128
            - r* (raw bits, where * is a multiple of 8)

  -f, --fill-value &lt;FILL_VALUE&gt;
          Fill value. See &lt;https://zarr-specs.readthedocs.io/en/latest/v3/core/v3.0.html#fill-value&gt;
          
          The fill value must be compatible with the data type.
          
          Examples:
            int/uint: 0 100 -100
            float: 0.0 "NaN" "Infinity" "-Infinity"
            r*: "[0, 255]"

      --separator &lt;SEPARATOR&gt;
          The chunk key encoding separator. Either . or /

  -c, --chunk-shape &lt;CHUNK_SHAPE&gt;
          Chunk shape. A comma separated list of the chunk size along each array dimension.
          
          If any dimension has size zero, it will be set to match the array shape.

  -s, --shard-shape &lt;SHARD_SHAPE&gt;
          Shard shape. A comma separated list of the shard size along each array dimension.
          
          If specified, the array is encoded using the sharding codec.
          If any dimension has size zero, it will be set to match the array shape.

      --array-to-array-codecs &lt;ARRAY_TO_ARRAY_CODECS&gt;
          Array to array codecs.
          
          JSON holding an array of array to array codec metadata.
          
          Examples:
            '[ { "name": "transpose", "configuration": { "order": [0, 2, 1] } } ]'
            '[ { "name": "bitround", "configuration": { "keepbits": 9 } } ]'

      --array-to-bytes-codec &lt;ARRAY_TO_BYTES_CODEC&gt;
          Array to bytes codec.
          
          JSON holding array to bytes codec metadata.
          
          Examples:
            '{ "name": "bytes", "configuration": { "endian": "little" } }'
            '{ "name": "pcodec", "configuration": { "level": 12 } }'
            '{ "name": "zfp", "configuration": { "mode": "fixedprecision", "precision": 19 } }'

      --bytes-to-bytes-codecs &lt;BYTES_TO_BYTES_CODECS&gt;
          Bytes to bytes codecs.
          
          JSON holding an array bytes to bytes codec configurations.
          
          Examples:
            '[ { "name": "blosc", "configuration": { "cname": "blosclz", "clevel": 9, "shuffle": "bitshuffle", "typesize": 2, "blocksize": 0 } } ]'
            '[ { "name": "bz2", "configuration": { "level": 9 } } ]'
            '[ { "name": "crc32c" } ]'
            '[ { "name": "gzip", "configuration": { "level": 9 } } ]'
            '[ { "name": "zstd", "configuration": { "level": 22, "checksum": false } } ]'

      --dimension-names &lt;DIMENSION_NAMES&gt;
          Dimension names (optional). Comma separated.

      --attributes &lt;ATTRIBUTES&gt;
          Attributes (optional).
          
          JSON holding array attributes.

      --attributes-append &lt;ATTRIBUTES_APPEND&gt;
          Attributes to append (optional).
          
          JSON holding array attributes.

      --chunk-limit &lt;CHUNK_LIMIT&gt;
          The maximum number of chunks concurrently processed.
          
          By default, this is set to the number of CPUs. Consider reducing this for images with large chunk sizes or on systems with low memory availability.

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
</details>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="match-input-encoding"><a class="header" href="#match-input-encoding">Match Input Encoding</a></h3>
<pre><code class="language-bash">zarrs_ome \
    --name "ABC-123" \
    --physical-size 2.0,2.0,2.0 \
    --physical-units micrometer,micrometer,micrometer \
    array.zarr array.ome.zarr
</code></pre>
<pre><code class="language-text">[00:00:00/00:00:00] 0 [1243, 1403, 1510] array.ome.zarr/0 rw:0.00/0.76 p:0.00
[00:00:14/00:00:14] 1 [621, 701, 755] array.ome.zarr/1 rw:1.95/0.51 p:12.24
[00:00:01/00:00:01] 2 [310, 350, 377] array.ome.zarr/2 rw:0.62/0.13 p:3.58
[00:00:00/00:00:00] 3 [155, 175, 188] array.ome.zarr/3 rw:0.06/0.01 p:0.26
[00:00:00/00:00:00] 4 [77, 87, 94] array.ome.zarr/4 rw:0.00/0.00 p:0.03
[00:00:00/00:00:00] 5 [38, 43, 47] array.ome.zarr/5 rw:0.00/0.00 p:0.01
[00:00:00/00:00:00] 6 [19, 21, 23] array.ome.zarr/6 rw:0.00/0.00 p:0.01
[00:00:00/00:00:00] 7 [9, 10, 11] array.ome.zarr/7 rw:0.00/0.00 p:0.00
[00:00:00/00:00:00] 8 [4, 5, 5] array.ome.zarr/8 rw:0.00/0.00 p:0.00
[00:00:00/00:00:00] 9 [2, 2, 2] array.ome.zarr/9 rw:0.00/0.00 p:0.00
[00:00:00/00:00:00] 10 [1, 1, 1] array.ome.zarr/10 rw:0.00/0.00 p:0.00
</code></pre>
<h3 id="change-encoding-and-downsampling-factor"><a class="header" href="#change-encoding-and-downsampling-factor">Change Encoding and Downsampling Factor</a></h3>
<pre><code class="language-bash">zarrs_ome \
    --name "ABC-123" \
    --physical-size 2.0,2.0,2.0 \
    --physical-units micrometer,micrometer,micrometer \
    --shard-shape 256,256,256 \
    --chunk-shape 32,32,32 \
    array.zarr array.ome.zarr 1,4,4
</code></pre>
<pre><code class="language-text">[00:00:01/00:00:01] 0 [1243, 1403, 1510] array.ome.zarr/0 rw:25.09/24.50 p:0.00
[00:00:12/00:00:12] 1 [1243, 350, 377] array.ome.zarr/1 rw:5.51/1.21 p:26.79
[00:00:00/00:00:00] 2 [1243, 87, 94] array.ome.zarr/2 rw:0.47/0.13 p:2.97
[00:00:00/00:00:00] 3 [1243, 21, 23] array.ome.zarr/3 rw:0.07/0.00 p:0.16
[00:00:00/00:00:00] 4 [1243, 5, 5] array.ome.zarr/4 rw:0.01/0.00 p:0.02
[00:00:00/00:00:00] 5 [1243, 1, 1] array.ome.zarr/5 rw:0.01/0.00 p:0.00
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarrs_filter"><a class="header" href="#zarrs_filter">zarrs_filter</a></h1>
<p>Apply simple image filters (transformations) to an array.</p>
<div class="mdbook-alerts mdbook-alerts-warning">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  warning
</p>
<p><code>zarrs_filter</code> is highly experimental, has had limited production testing, and is sparsely documented.</p>
</div>
<p>The filters currently supported are:</p>
<ul>
<li><strong>reencode</strong>:            Reencode (change encoding, data type, etc.).</li>
<li><strong>crop</strong>:                Crop given an offset and shape.</li>
<li><strong>rescale</strong>:             Rescale values given a multiplier and offset.</li>
<li><strong>clamp</strong>:               Clamp values between a minimum and maximum.</li>
<li><strong>equal</strong>:               Return a binary image where the input is equal to some value.</li>
<li><strong>downsample</strong>:          Downsample given a stride.</li>
<li><strong>gradient-magnitude</strong>:  Compute the gradient magnitude.</li>
<li><strong>gaussian</strong>:            Apply a Gaussian kernel.</li>
<li><strong>summed area table</strong>:   Compute the summed area table.</li>
<li><strong>guided filter</strong>:       Apply a guided filter (edge-preserving noise filter).</li>
</ul>
<h2 id="installation-3"><a class="header" href="#installation-3">Installation</a></h2>
<p><code>zarrs_filter</code> is installed with the <code>filter</code> feature of <code>zarrs_tools</code>.</p>
<h3 id="prebuilt-binaries-2"><a class="header" href="#prebuilt-binaries-2">Prebuilt Binaries</a></h3>
<pre><code class="language-bash"># Requires cargo-binstall https://github.com/cargo-bins/cargo-binstall
cargo binstall zarrs_tools
</code></pre>
<h3 id="from-source-2"><a class="header" href="#from-source-2">From Source</a></h3>
<pre><code class="language-bash">cargo install --features=filter zarrs_tools
</code></pre>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<details>
<summary>zarrs_filter --help</summary>
<pre><code class="language-text">Apply simple image filters (transformations) to a Zarr array

Usage: zarrs_filter [OPTIONS] [RUN_CONFIG] [COMMAND]

Commands:
  reencode            Reencode an array
  crop                Crop an array given an offset and shape
  rescale             Rescale array values given a multiplier and offset
  clamp               Clamp values between a minimum and maximum
  equal               Return a binary image where the input is equal to some value
  downsample          Downsample an image given a stride
  gradient-magnitude  Compute the gradient magnitude
  gaussian            Apply a Gaussian kernel
  summed-area-table   Compute a summed area table (integral image)
  guided-filter       Apply a guided filter (edge-preserving noise filter)
  replace-value       Replace a value with another value
  help                Print this message or the help of the given subcommand(s)

Arguments:
  [RUN_CONFIG]
          Path to a JSON run configuration

Options:
      --exists &lt;EXISTS&gt;
          Behaviour if the output exists
          
          [default: erase]

          Possible values:
          - erase: Erase the output
          - exit:  Exit if the output already exists

      --tmp &lt;TMP&gt;
          Directory for temporary arrays.
          
          If omitted, defaults to the platform-specific temporary directory (e.g. ${TMPDIR}, /tmp, etc.)

      --chunk-limit &lt;CHUNK_LIMIT&gt;
          The maximum number of chunks concurrently processed.
          
          By default, this is set to the number of CPUs. Consider reducing this for images with large chunk sizes or on systems with low memory availability.

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
</details>
<p>Run <code>zarrs_filter &lt;COMMAND&gt; --help</code> for more information on a specific command.</p>
<h2 id="examples-cli"><a class="header" href="#examples-cli">Examples (CLI)</a></h2>
<pre><code class="language-bash">export ENCODE_ARGS="--shard-shape 256,256,256 --chunk-shape 32,32,32"
zarrs_filter reencode           array.zarr       array_reenc.zarr               ${ENCODE_ARGS}
zarrs_filter reencode           array_reenc.zarr array_reenc_int32.zarr         ${ENCODE_ARGS} --data-type int32
zarrs_filter reencode           array_reenc.zarr array_reenc_float32.zarr       ${ENCODE_ARGS} --data-type float32
zarrs_filter crop               array_reenc.zarr array_crop.zarr                ${ENCODE_ARGS} --data-type float32 256,256,256 768,768,768
zarrs_filter rescale            array_reenc.zarr array_rescale.zarr             ${ENCODE_ARGS} --data-type float32 2.0 1.0 --fill-value 1.0
zarrs_filter clamp              array_reenc.zarr array_clamp.zarr               ${ENCODE_ARGS} --data-type float32 5 255 --fill-value 5.0
# zarrs_filter equal              array_reenc.zarr array_eq_bool.zarr             ${ENCODE_ARGS} --data-type bool 1 --fill-value true
zarrs_filter equal              array_reenc.zarr array_eq_u8.zarr               ${ENCODE_ARGS} --data-type uint8 1 --fill-value 1
zarrs_filter downsample         array_reenc.zarr array_downsample.zarr          ${ENCODE_ARGS} --data-type float32 2,2,2
zarrs_filter downsample         array_eq_u8.zarr array_downsample_discrete.zarr ${ENCODE_ARGS} --data-type uint8 2,2,2 --discrete
zarrs_filter gradient-magnitude array_reenc.zarr array_gradient_magnitude.zarr  ${ENCODE_ARGS} --data-type float32
zarrs_filter gaussian           array_reenc.zarr array_gaussian.zarr            ${ENCODE_ARGS} --data-type float32 1.0,1.0,1.0 3,3,3
zarrs_filter summed-area-table  array_reenc.zarr array_sat.zarr                 ${ENCODE_ARGS} --data-type int64
zarrs_filter guided-filter      array_reenc.zarr array_guided_filter.zarr       ${ENCODE_ARGS} --data-type float32 40000 3
zarrs_filter replace-value      array_reenc.zarr array_replace.zarr             ${ENCODE_ARGS} 65535 0 --fill-value 0
</code></pre>
<h2 id="examples-config"><a class="header" href="#examples-config">Examples (Config)</a></h2>
<pre><code class="language-bash">zarrs_filter &lt;RUN.json&gt;
</code></pre>
<details>
<summary>run.json</summary>
<pre><code class="language-json">[
    {
        "_comment": "Rechunk the input",
        "filter": "reencode",
        "input": "array.zarr",
        "output": "$reencode0",
        "shard_shape": [256, 256, 256],
        "chunk_shape": [32, 32, 32]
    },
    {
        "_comment": "Reencode the previous output as float32, automatically cast the fill value",
        "filter": "reencode",
        "output": "array_float32.zarr",
        "data_type": "float32"
    },
    {
        "filter": "crop",
        "input": "$reencode0",
        "output": "array_crop.zarr",
        "offset": [256, 256, 256],
        "shape": [768, 768, 768]
    },
    {
        "filter": "replace_value",
        "input": "$reencode0",
        "output": "array_replace.zarr",
        "value": 65535,
        "replace": 0
    },
    {
        "_comment": "Multiply by 7.0/20000.0, casting most values in the image between 0 and 7, store in 8-bit (saturate cast)",
        "filter": "rescale",
        "input": "$reencode0",
        "output": "array_3bit.zarr",
        "multiply": 0.00035,
        "add": 0.0,
        "data_type": "uint8",
        "fill_value": 0
    },
    {
        "_comment": "Multiply by 255.0/20000.0, casting most values in the image between 0 and 7, store in 8-bit (saturate cast)",
        "filter": "rescale",
        "input": "$reencode0",
        "output": "array_8bit.zarr",
        "multiply": 0.01275,
        "add": 0.0,
        "data_type": "uint8",
        "fill_value": 0
    },
    {
        "_comment": "Clamp the 3-bit output between 2 and 5 and set the fill value to 2",
        "filter": "clamp",
        "output": "array_3bit_clamp.zarr",
        "min": 2,
        "max": 5,
        "fill_value": 2
    },
    {
        "_comment": "Calculate a binary image where the input is equal to 5 (the max from the clamp). Store as bool",
        "filter": "equal",
        "input": "array_3bit_clamp.zarr", 
        "output": "array_clamp_equal_bool.zarr",
        "value": 5
    },
    {
        "_comment": "Calculate a binary image where the input is equal to 5 (the max from the clamp). Store as uint8",
        "filter": "equal",
        "input": "array_3bit_clamp.zarr",
        "output": "array_3bit_max.zarr",
        "value": 5,
        "data_type": "uint8",
        "fill_value": 0
    },
    {
        "_comment": "Downsample clamped image by a factor of 2 with mean operator.",
        "filter": "downsample",
        "input": "array_3bit_clamp.zarr",
        "output": "array_3bit_clamp_by2_continuous.zarr",
        "stride": [2, 2, 2],
        "discrete": false,
        "data_type": "float32",
        "shard_shape": [128, 128, 128],
        "chunk_shape": [32, 32, 32]
    },
    {
        "_comment": "Downsample clamped image by a factor of 2 with mode operator.",
        "filter": "downsample",
        "input": "array_3bit_clamp.zarr",
        "output": "array_3bit_clamp_by2_discrete.zarr",
        "stride": [2, 2, 2],
        "discrete": true,
        "shard_shape": [128, 128, 128],
        "chunk_shape": [32, 32, 32]
    },
    {
        "filter": "gradient_magnitude",
        "input": "$reencode0",
        "output": "array_gradient.zarr"
    },
    {
        "filter": "gaussian",
        "input": "$reencode0",
        "output": "array_gaussian.zarr",
        "sigma": [1.0, 1.0, 1.0],
        "kernel_half_size": [3, 3, 3]
    },
    {
        "filter": "summed_area_table",
        "input": "$reencode0",
        "output": "array_sat.zarr",
        "data_type": "float32"
    },
    {
        "filter": "guided_filter",
        "input": "$reencode0",
        "output": "array_guided_filter.zarr",
        "epsilon": 40000.0,
        "radius": 3,
        "data_type": "float32"
    }
]
</code></pre>
</details>
<details>
<summary>output</summary>
<pre><code class="language-text">0 reencode
        args:   {}
        encode: {"chunk_shape":[32,32,32],"shard_shape":[256,256,256]}
        input:  uint16 [1243, 1403, 1510] "array.zarr"
        output: uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
1 reencode
        args:   {}
        encode: {"data_type":"float32"}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: float32 [1243, 1403, 1510] "array_float32.zarr" (overwrite)
2 crop
        args:   {"offset":[256,256,256],"shape":[768,768,768]}
        encode: {}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: uint16 [768, 768, 768] "array_crop.zarr" (overwrite)
3 replace_value
        args:   {"value":65535,"replace":0}
        encode: {}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: uint16 [1243, 1403, 1510] "array_replace.zarr" (overwrite)
4 rescale
        args:   {"multiply":0.00035,"add":0.0,"add_first":false}
        encode: {"data_type":"uint8","fill_value":0}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: uint8 [1243, 1403, 1510] "array_3bit.zarr" (overwrite)
5 rescale
        args:   {"multiply":0.01275,"add":0.0,"add_first":false}
        encode: {"data_type":"uint8","fill_value":0}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: uint8 [1243, 1403, 1510] "array_8bit.zarr" (overwrite)
6 clamp
        args:   {"min":2.0,"max":5.0}
        encode: {"fill_value":2}
        input:  uint8 [1243, 1403, 1510] "array_8bit.zarr"
        output: uint8 [1243, 1403, 1510] "array_3bit_clamp.zarr" (overwrite)
7 equal
        args:   {"value":5}
        encode: {}
        input:  uint8 [1243, 1403, 1510] "array_3bit_clamp.zarr"
        output: bool [1243, 1403, 1510] "array_clamp_equal_bool.zarr" (overwrite)
8 equal
        args:   {"value":5}
        encode: {"data_type":"uint8","fill_value":0}
        input:  uint8 [1243, 1403, 1510] "array_3bit_clamp.zarr"
        output: uint8 [1243, 1403, 1510] "array_3bit_max.zarr" (overwrite)
9 downsample
        args:   {"stride":[2,2,2],"discrete":false}
        encode: {"data_type":"float32","chunk_shape":[32,32,32],"shard_shape":[128,128,128]}
        input:  uint8 [1243, 1403, 1510] "array_3bit_clamp.zarr"
        output: float32 [621, 701, 755] "array_3bit_clamp_by2_continuous.zarr" (overwrite)
10 downsample
        args:   {"stride":[2,2,2],"discrete":true}
        encode: {"chunk_shape":[32,32,32],"shard_shape":[128,128,128]}
        input:  uint8 [1243, 1403, 1510] "array_3bit_clamp.zarr"
        output: uint8 [621, 701, 755] "array_3bit_clamp_by2_discrete.zarr" (overwrite)
11 gradient_magnitude
        args:   {}
        encode: {}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: uint16 [1243, 1403, 1510] "array_gradient.zarr" (overwrite)
12 gaussian
        args:   {"sigma":[1.0,1.0,1.0],"kernel_half_size":[3,3,3]}
        encode: {}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: uint16 [1243, 1403, 1510] "array_gaussian.zarr" (overwrite)
13 summed area table
        args:   {}
        encode: {"data_type":"float32"}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: float32 [1243, 1403, 1510] "array_sat.zarr" (overwrite)
14 guided_filter
        args:   {"epsilon":40000.0,"radius":3}
        encode: {"data_type":"float32"}
        input:  uint16 [1243, 1403, 1510] "/tmp/.tmpCbeEcJ/$reencode0bxiFEM"
        output: float32 [1243, 1403, 1510] "array_guided_filter.zarr" (overwrite)
[00:00:02/00:00:02] reencode /tmp/.tmpCbeEcJ/$reencode0bxiFEM rw:34.78/28.90 p:0.00
[00:00:04/00:00:04] reencode array_float32.zarr rw:30.06/76.57 p:14.16
[00:00:00/00:00:00] crop array_crop.zarr rw:3.46/3.34 p:0.00
[00:00:02/00:00:02] replace_value array_replace.zarr rw:26.73/47.32 p:7.25
[00:00:01/00:00:01] rescale array_3bit.zarr rw:18.11/14.43 p:11.55
[00:00:01/00:00:01] rescale array_8bit.zarr rw:23.54/21.99 p:11.08
[00:00:00/00:00:00] clamp array_3bit_clamp.zarr rw:9.70/10.34 p:0.96
[00:00:00/00:00:00] equal array_clamp_equal_bool.zarr rw:10.61/9.32 p:4.56
[00:00:00/00:00:00] equal array_3bit_max.zarr rw:10.29/9.49 p:3.61
[00:00:02/00:00:02] downsample array_3bit_clamp_by2_continuous.zarr rw:7.01/1.95 p:71.76
[00:00:06/00:00:06] downsample array_3bit_clamp_by2_discrete.zarr rw:16.08/1.01 p:168.86
[00:00:20/00:00:20] gradient_magnitude array_gradient.zarr rw:147.16/14.38 p:289.05
[00:00:10/00:00:10] gaussian array_gaussian.zarr rw:36.19/22.01 p:181.06
[00:00:23/00:00:23] summed area table array_sat.zarr rw:190.51/215.68 p:54.39
[00:01:51/00:01:51] guided_filter array_guided_filter.zarr rw:29.57/59.96 p:2427.96
</code></pre>
</details>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarrs_validate"><a class="header" href="#zarrs_validate">zarrs_validate</a></h1>
<p>Compare the data in two Zarr arrays.</p>
<h2 id="installation-4"><a class="header" href="#installation-4">Installation</a></h2>
<p><code>zarrs_validate</code> is installed with the <code>validate</code> feature of <code>zarrs_tools</code>.</p>
<h3 id="prebuilt-binaries-3"><a class="header" href="#prebuilt-binaries-3">Prebuilt Binaries</a></h3>
<pre><code class="language-bash"># Requires cargo-binstall https://github.com/cargo-bins/cargo-binstall
cargo binstall zarrs_tools
</code></pre>
<h3 id="from-source-3"><a class="header" href="#from-source-3">From Source</a></h3>
<pre><code class="language-bash">cargo install --features=validate zarrs_tools
</code></pre>
<h2 id="usage-3"><a class="header" href="#usage-3">Usage</a></h2>
<details>
<summary>zarrs_validate --help</summary>
<pre><code class="language-text">Compare the data in two Zarr arrays.

Equality of the arrays is determined by comparing the shape, data type, and data.

Differences in encoding (e.g codecs, chunk key encoding) and attributes are ignored.

Usage: zarrs_validate [OPTIONS] &lt;FIRST&gt; &lt;SECOND&gt;

Arguments:
  &lt;FIRST&gt;
          The path to the first zarr array

  &lt;SECOND&gt;
          The path to the second zarr array

Options:
      --concurrent-chunks &lt;CONCURRENT_CHUNKS&gt;
          Number of concurrent chunks to compare

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
</details>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarrs_info"><a class="header" href="#zarrs_info">zarrs_info</a></h1>
<p>Get information about a Zarr array or group.</p>
<h2 id="installation-5"><a class="header" href="#installation-5">Installation</a></h2>
<p><code>zarrs_info</code> is installed with the <code>info</code> feature of <code>zarrs_tools</code>.</p>
<h3 id="prebuilt-binaries-4"><a class="header" href="#prebuilt-binaries-4">Prebuilt Binaries</a></h3>
<pre><code class="language-bash"># Requires cargo-binstall https://github.com/cargo-bins/cargo-binstall
cargo binstall zarrs_tools
</code></pre>
<h3 id="from-source-4"><a class="header" href="#from-source-4">From Source</a></h3>
<pre><code class="language-bash">cargo install --features=info zarrs_tools
</code></pre>
<h2 id="usage-4"><a class="header" href="#usage-4">Usage</a></h2>
<details>
<summary>zarrs_info --help</summary>
<pre><code class="language-text">Get information about a Zarr array or group.

Outputs are JSON encoded.

Usage: zarrs_info [OPTIONS] &lt;PATH&gt; &lt;COMMAND&gt;

Commands:
  metadata         Get the array/group metadata
  metadata-v3      Get the array/group metadata (interpreted as V3)
  attributes       Get the array/group attributes
  shape            Get the array shape
  data-type        Get the array data type
  fill-value       Get the array fill value
  dimension-names  Get the array dimension names
  range            Get the array data range
  histogram        Get the array data histogram
  help             Print this message or the help of the given subcommand(s)

Arguments:
  &lt;PATH&gt;
          Path to the Zarr input array or group

Options:
      --chunk-limit &lt;CHUNK_LIMIT&gt;
          The maximum number of chunks concurrently processed.
          
          Defaults to the RAYON_NUM_THREADS environment variable or the number of logical CPUs. Consider reducing this for images with large chunk sizes or on systems with low memory availability.
          
          [default: 24]

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
</details>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<h4 id="data-type"><a class="header" href="#data-type">Data Type</a></h4>
<pre><code class="language-bash">zarrs_info array.zarr data-type
</code></pre>
<pre><code class="language-text">{
  "data_type": "uint16"
}
</code></pre>
<h3 id="array-shape"><a class="header" href="#array-shape">Array Shape</a></h3>
<pre><code class="language-bash">zarrs_info array.zarr shape
</code></pre>
<pre><code class="language-text">{
  "shape": [
    1243,
    1403,
    1510
  ]
}
</code></pre>
<h3 id="data-range"><a class="header" href="#data-range">Data Range</a></h3>
<pre><code class="language-bash">zarrs_info array.zarr range
</code></pre>
<pre><code class="language-text">{
  "min": 0,
  "max": 65535
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="zarrs_binary2zarr"><a class="header" href="#zarrs_binary2zarr">zarrs_binary2zarr</a></h1>
<p>Create a Zarr V3 array from piped binary data.</p>
<h2 id="installation-6"><a class="header" href="#installation-6">Installation</a></h2>
<p><code>zarrs_binary2zarr</code> is installed with the <code>binary2zarr</code> feature of <code>zarrs_tools</code>.</p>
<h3 id="prebuilt-binaries-5"><a class="header" href="#prebuilt-binaries-5">Prebuilt Binaries</a></h3>
<pre><code class="language-bash"># Requires cargo-binstall https://github.com/cargo-bins/cargo-binstall
cargo binstall zarrs_tools
</code></pre>
<h3 id="from-source-5"><a class="header" href="#from-source-5">From Source</a></h3>
<pre><code class="language-bash">cargo install --features=binary2zarr zarrs_tools
</code></pre>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<p><code>chameleon_1024x1024x1080.uint16</code> is an uncompressed binary 3D image split into multiple files with</p>
<ul>
<li>(depth, height, width) = <code>(1080, 1024, 1024)</code></li>
<li>data type = <code>uint16</code></li>
</ul>
<pre><code class="language-bash">tree --du -h chameleon_1024x1024x1080.uint16
</code></pre>
<pre><code class="language-text">[2.1G]  chameleon_1024x1024x1080.uint16
├── [512M]  xaa
├── [512M]  xab
├── [512M]  xac
├── [512M]  xad
└── [112M]  xae
</code></pre>
<p>With the following command, the image is encoded as a zarr array with the <code>sharding</code> codec with a <em>shard shape</em> of <code>(128, 1024, 1024)</code></p>
<ul>
<li>inner chunks in each shard have a <em>chunk shape</em> of <code>(32, 32, 32)</code></li>
<li>inner chunks are compressed using the <code>blosc</code> codec</li>
</ul>
<pre><code class="language-bash">cat chameleon_1024x1024x1080.uint16/* | \
zarrs_binary2zarr \
--data-type uint16 \
--fill-value 0 \
--separator '.' \
--array-shape 1080,1024,1024 \
--chunk-shape 32,32,32 \
--shard-shape 128,1024,1024 \
--bytes-to-bytes-codecs '[ { "name": "blosc", "configuration": { "cname": "blosclz", "clevel": 9, "shuffle": "bitshuffle", "typesize": 2, "blocksize": 0 } } ]' \
chameleon_1024x1024x1080.zarr
</code></pre>
<pre><code class="language-bash">tree --du -h chameleon_1024x1024x1080.zarr
</code></pre>
<pre><code class="language-text">[1.3G]  chameleon_1024x1024x1080.zarr
├── [152M]  c.0.0.0
├── [157M]  c.1.0.0
├── [157M]  c.2.0.0
├── [156M]  c.3.0.0
├── [152M]  c.4.0.0
├── [150M]  c.5.0.0
├── [152M]  c.6.0.0
├── [152M]  c.7.0.0
├── [ 67M]  c.8.0.0
└── [1.2K]  zarr.json
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>
        <script src="theme/pagetoc.js"></script>

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
